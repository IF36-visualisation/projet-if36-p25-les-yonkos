---
title: "Analyse des Combats de MMA dans l'UFC"
author: "IF36 - Les Yonkos"
date: "UTT - P25"
output:
  word_document: default
  html_document:
    theme: cerulean 
    toc: true 
    toc_float: true 
    highlight: tango
    warning: false
    message: false
  pdf_document:
    toc: true 
    warning: false
    message: false
editor_options:
  markdown:
    wrap: sentence
---
<style>
body {
  background-color: #fdf6e3;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.width = 10,
  fig.height = 6
)
```

## Table des matières

> [Introduction](#section-1) <br> [I. Données](#section-2) <br> [II. Exploration](#section-3) <br> [III. Conclusion](#section-4) <br>

<a id="section-1"></a>

# Introduction

&ensp;Pour notre projet, on a travaillé avec deux datasets sur les combats de MMA dans l'UFC. Le premier, **"Complete UFC Data"**, contient des informations sur les événements, les combattants et leurs statistiques de combat, ainsi que les cotes des paris. Ce dataset couvre une période de **1994 à 2023**, ce qui nous donne beaucoup de matière pour analyser les performances et les tendances dans le MMA.

&ensp;Le second dataset, **"Pro MMA Fighters"**, se focalise plutôt sur les combattants eux-mêmes, avec leurs caractéristiques personnelles, physiques et leur bilan de carrière. Par contre, les données ne sont à jour que jusqu'en **2022**, donc un peu limité pour les analyses récentes.

&ensp;On a choisi ces deux jeux de données pour explorer ce qui influence les résultats des combats et pour comprendre l'impact de différents facteurs comme les attributs physiques, les styles de combat et les cotes des paris.

&ensp;Pour les premières questions, on a principalement utilisé le premier dataset, tandis que le second nous servira pour des problématiques plus complexes.

<a id="section-2"></a>

# I. Données

### 1. Complete UFC Data
Ce dataset contient des infos détaillées sur les combats de l'UFC :
- Les événements (date, lieu, etc.)
- Les combattants (nom, âge, taille, poids, etc.)
- Les statistiques de combat (coups portés, takedowns, etc.)
- Les cotes des paris

Les données couvrent **1994 à 2023**, ce qui nous permet d'analyser les tendances sur une bonne période de temps.

### 2. Pro MMA Fighters
Ce dataset se concentre sur les combattants :
- Infos personnelles (âge, nationalité, etc.)
- Attributs physiques (taille, poids, allonge, etc.)
- Bilan de carrière (victoires, défaites, etc.)

Les données sont dispo jusqu'en **2022**, donc pas super à jour pour les analyses récentes.

<a id="section-3"></a>

# II. Exploration

Voici les questions qu'on a essayé de résoudre avec nos visualisations et nos interprétations.

D'abord, on charge les bibliothèques et les données dont on a besoin :

```{r load_data}
library(ggplot2)
library(dplyr)
library(tidyr)
library(scales)
library(readr)
library(stringr)
library(tidyverse)
library(lubridate)


data <- read_csv("data/complete_ufc_data.csv", show_col_types = FALSE)
df <- data

```

### Question 1 : Durant quel round la majorité des combats se terminent ?

Nous supposons que la majorité des rounds se terminent vers le milieu du combat : au 2ème ou 3ème round. Il y a aussi sûrement beaucoup de KO où le combat se finit vite. 

Commençons par nettoyer les données pour la question : enlever les NA et convertir la colonne 'round' en facteur.

```{r data_cleaning}

df_clean <- data %>%
  filter(!is.na(round)) %>%
  mutate(round = as.factor(round))
```

#### Visualisation : Histogramme de répartition des fins de combats par round

```{r histogram_round_distribution}

ggplot(df_clean, aes(x = round)) +
  geom_bar(fill = "#1b9e77", width = 0.6, show.legend = FALSE) +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5, size = 4.5) +
  labs(
    title = "Répartition des fins de combats par round",
    subtitle = "Analyse des rounds les plus fréquents de fin de combat",
    x = "Round",
    y = "Nombre de combats terminés",
    caption = "Source: Données UFC"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16, color = "#2c3e50"),
    plot.subtitle = element_text(size = 13, color = "#7f8c8d"),
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold")
  ) +
  expand_limits(y = max(table(df_clean$round)) * 1.1)
```

**Interprétation :** Le graphique permet de répondre clairement à la question posée, le round 3 est celui où la majorité des combats se terminent. Cela montre que les combats ne s'arrêtent pas forcément sur un KO ou une soumission précoce comme certains qui pourraient le penser. 


##### Conclusion question 1

D’après le graphique, **le round 3 est le round de fin le plus fréquent**.  
On observe également que plusieurs combats prennent fin lors des deux premiers rounds.

Néanmoins, les rounds 4 et 5 s’avèrent être beaucoup plus rares, ce qui est logique puisqu’ils ne concernent généralement que les combats principaux (*main events* ou *title fights*).
De même, les combats semblent durer au moins un certain temps avant de se conclure, ce qui peut représenter des affrontements équilibrés, des stratégies de fatigue progressive ou des combats à l’usure.



### Question 2 : L’allonge est-elle un avantage significatif pour gagner un combat ?

Nous cherchons à déterminer si l'allonge représente un avantage significatif pour remporter un combat et comment cet avantage potentiel peut se manifester dans les stratégies employées par les combattants.
Nous tenons l'hypothèse que l'allonge est un facteur très important et qu'elle impacte la stratégie des combatttants. 

#### Visualisation 1: Proportion de victoires par catégorie de différence d'allonge

```{r barplot_proportion_victoires}
# Calcul de la différence d'allonge
data$reach_diff <- data$fighter1_reach - data$fighter2_reach

# Création de catégories de différence d'allonge (valeur absolue)
data$reach_category <- cut(abs(data$reach_diff),
                                 breaks = c(0, 5, 10, 15, 20, 25),
                                 labels = c("0-5", "5-10", "10-15", "15-20", "20+"))

# Calcul des proportions de victoires par catégorie
victory_proportion <- data %>%
  filter(!is.na(reach_category)) %>%
  group_by(reach_category) %>%
  summarize(
    total_combats = n(),
    victoires_plus_grande_allonge = sum(reach_diff > 0),
    victoires_plus_petite_allonge = sum(reach_diff < 0),
    proportion_victoire_grande_allonge = victoires_plus_grande_allonge / total_combats,
    proportion_victoire_petite_allonge = victoires_plus_petite_allonge / total_combats
  )

# Restructuration pour la visualisation
victory_data <- victory_proportion %>%
  select(reach_category, 
         `Grande allonge` = proportion_victoire_grande_allonge, 
         `Petite allonge` = proportion_victoire_petite_allonge) %>%
  pivot_longer(cols = c(`Grande allonge`, `Petite allonge`),
               names_to = "type_victoire",
               values_to = "proportion")

# Création du barplot empilé
ggplot(victory_data, aes(x = reach_category, y = proportion, fill = type_victoire)) +
  geom_bar(stat = "identity", position = "stack") +
  geom_text(aes(label = scales::percent(proportion, accuracy = 1)), 
            position = position_stack(vjust = 0.5)) +
  labs(title = "Proportion de victoires par catégorie de différence d'allonge",
       subtitle = "Basé sur la valeur absolue de la différence d'allonge",
       x = "Différence d'allonge (cm)",
       y = "Proportion",
       fill = "Résultat",
       caption = "Source: Données UFC") +
  scale_fill_manual(values = c("Grande allonge" = "forestgreen", 
                               "Petite allonge" = "firebrick")) +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal()
```


**Interprétation :** Ce graphique montre, pour chaque catégorie de différence d'allonge, quelle proportion de combats est remportée par des combattants avec une allonge supérieure ou inférieure. Il permet de se rendre compte que l'avantage d'allonge devient de plus en plus significatif sur la victoire dans un combat à mesure qu'elle augmente.

#### Visualisation 2 : Nombre brut de victoires selon l'avantage d'allonge

Pour compléter notre analyse, examinons également le nombre brut de victoires selon l'avantage d'allonge.

```{r barplot_nombre_victoires}
# Créer une variable catégorielle pour l'avantage d'allonge
data$reach_advantage <- ifelse(data$reach_diff > 0, 
                               "Gagnant avec allonge supérieure",
                               ifelse(data$reach_diff < 0, 
                                      "Gagnant avec allonge inférieure",
                                      "Allonge égale"))

# Compter le nombre de combats dans chaque catégorie
reach_victory_counts <- data %>%
  group_by(reach_advantage) %>%
  summarize(
    nombre_victoires = n()
  )

# Créer le barplot
ggplot(reach_victory_counts, aes(x = reach_advantage, y = nombre_victoires, fill = reach_advantage)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = nombre_victoires), vjust = -0.5) +
  labs(title = "Nombre de victoires selon l'avantage d'allonge",
       x = "Type d'avantage d'allonge",
       y = "Nombre de victoires",
       caption = "Source: Données UFC") +
  scale_fill_manual(values = c("Gagnant avec allonge supérieure" = "forestgreen", 
                               "Gagnant avec allonge inférieure" = "firebrick",
                               "Allonge égale" = "goldenrod")) +
  theme_minimal() +
  theme(legend.position = "none")
```
**Interprétation :** On voit ici que ceux ayant une allonge supérieure gagnent plus souvent que leurs adversaires, avec une allonge plus faible, même si le résultat n'est pas unanime.

#### Visualisation 3: Impact de l'allonge sur les coups significatifs portés

Ce graphique analyse la relation entre la différence d'allonge du fighter 1 face au fighter 2 (en pourcentage) et la différence de coups significatifs portés par minute entre les combattants. On pourrait penser que plus un combattant possède une grande allonge, plus il l'utiliserait pour porter des coups à son adversaire.

```{r scatterplot_strikes}
# Calcul des différences relatives d'allonge et de striking
data$reach_diff_pct <- (data$fighter1_reach - data$fighter2_reach) / data$fighter2_reach * 100
data$strike_diff <- data$fighter1_sig_strikes_landed_pm - data$fighter2_sig_strikes_landed_pm

# Graphique de dispersion avec ligne de régression
ggplot(data, aes(x = reach_diff_pct, y = strike_diff)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = TRUE, color = "blue") +
  labs(title = "Impact de l'allonge sur les coups significatifs portés",
       x = "Différence d'allonge entre les combattants (%)",
       y = "Différence de coups portés par minute",
       caption = "Source: Données UFC") +
  theme_minimal()
```

**Interprétation :** Cette visualisation nous permet de nous rendre compte qu'une plus grande allonge ne se traduit pas forcément par un avantage en termes de coups portés. La ligne de régression indique la tendance générale (la pente) est très légèrement positive. L'allonge a donc un impact, mais il est plus léger que ce qu'on pourrait penser.

#### Visualisation 4: Impact de l'allonge sur les tentatives de takedown

Cette visualisation examine, de la même manière, la relation entre la différence d'allonge du fighter 1 face au fighter 2 (en pourcentage) et la différence de takedowns tentés par 15 minutes entre les combattants On pourrait penser qu'un combattant ayant une plus petite allonge que son adversaire va tenter de l'emmener au sol, afin de compenser le déséquilibre debout.

```{r scatterplot_takedowns}
# Calcul de la différence de takedowns
data$takedown_diff <- data$fighter1_takedown_avg_per15m - data$fighter2_takedown_avg_per15m

# Graphique de dispersion avec ligne de régression
ggplot(data, aes(x = reach_diff_pct, y = takedown_diff)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = TRUE, color = "green") +
  labs(title = "Impact de l'allonge sur les tentatives de takedown",
       x = "Différence d'allonge entre les combattants (%)",
       y = "Différence de takedowns effectués par 15 min" , 
       caption = "Source: Données UFC") +
  theme_minimal()
```

**Interprétation :** Ce graphique nous permet de voir déjà plus clairement la stratégie utilisée par les combattants concernant les takedowns. La pente est négative, elle indique donc que les combattants avec une allonge inférieure compensent en tentant plus de projections au sol. Notre hypothèse est donc vérifiée. 

##### Conclusion question 2
Ces visualisations nous permettent d'analyser sous différents angles l'impact de l'allonge sur les performances et les résultats des combats UFC. Nous pouvons désormais répondre à nos questions initiales:

1.  **À quel point l'allonge peut être un avantage significatif pour gagner un combat?**
    -   Les visualisations 1 et 2 offrent des perspectives claires sur cette question, en montrant la différence entre gagnants et perdants ainsi que les proportions de victoires par catégorie d'allonge. On se rend compte que plus la différence d'allonge est grande, plus elle a un impact sur la finalité du combat
2.  **Un combattant devrait-il accepter un combat face à un adversaire disposant d'une plus grande allonge?**
    -   La visualisation 1 est particulièrement utile pour répondre à cette question, car elle montre les proportions de victoires en fonction de l'écart d'allonge. Un combattant ne devrait ainsi pas accepter un combat lorsqu'il a une allonge plus de 20 centimètres plus petite que son adversaire, les chances de victoire étant grandement réduites.
3.  **Avoir une grande allonge pousse-t-elle le combattant à utiliser son striking ou à tenter des takedowns?**
    -   Les visualisations 3 et 4 explorent cette question en montrant comment l'allonge influence les stratégies de frappe et de projection. Elle n'est pas si significative pour les coups, mais on se rend compte qu'une plus petite allonge engendre un nombre de takedowns plus élevé.



### Question 3 : Quel type de garde est la plus dominante (southpaw, orthodox...) ?

Cette question vise à découvrir si l'utilisation d'une stance (Garde de combat) peut être un facteur de réussite lors des combats.

Dans le dataset, les stances sont répartis en deux colonnes : fighter1_stance et fighter2_stance.
On va donc commencer par regrouper ces deux colonnes en une seule et pour chacune des lignes on indiquera si l'utilisation de la stance a mené à une victoire ou à une défaite.

```{r load_data_q3}

winners <- data %>%
  select(stance = fighter1_stance) %>%
  mutate(result = "Victoire")

losers <- data %>%
  select(stance = fighter2_stance) %>%
  mutate(result = "Défaite")


stances <- bind_rows(winners, losers)
stances <- stances %>%
  filter(!is.na(stance) & stance != "")
```

#### Visualisation 1 : Nombre d'utilisation de chaque stance

Il est difficile d'établir un véritable classement ici, mais la garde orthodoxe devrait logiquement être la plus utilisée. C'est la plus répandue, notamment en boxe où elle est très courante.

```{r graph_1}
stance_usage <- stances %>%
  group_by(stance) %>%
  summarise(count = n()) %>%
  arrange(desc(count))  

ggplot(stance_usage, aes(x = reorder(stance, -count), y = count, fill = stance)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = count), vjust = -0.5, size = 4) +  
  labs(
    title = "Nombre d'utilisation de chaque stance",
    x = "Stance",
    y = "Nombre d'apparitions",
    caption = "Source: Données UFC"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

**Interprétation :** Ce graphique démontre que l'écrasante majorité des combats utilise une garde orthodox.
Le seul argument qui pourrait nous empêcher de considérer la garde orthodox comme étant la meilleure garde à utiliser serait que la southpaw ou la switch possède un taux de victoires très élevé. 
En revanche, on peut d'ores et déjà éliminer les autres gardes de notres analyse car leur nombre d'utilisation est négligeable.


#### Visualisation 2 : Taux de victoire

On cherche donc le taux de victoire des trois gardes les plus utilisées (Orthodox, Southpaw et Switch). On pourrait supposer, par sa grande domination, que l'orthodox a un taux de victoire plus élévé.
```{r graph_2}
stance_summary <- stances %>%
  filter(stance %in% c("Orthodox", "Switch", "Southpaw")) %>%
  group_by(stance, result) %>%
  summarise(count = n()) %>%
  group_by(stance) %>%
  mutate(percent = count / sum(count)) %>%
  ungroup()

ggplot(stance_summary, aes(x = stance, y = percent, fill = result)) +
  geom_bar(stat = "identity", position = "fill") +
  geom_text(aes(label = scales::percent(percent, accuracy = 1)), 
            position = position_fill(vjust = 0.5), 
            size = 3, color = "white") +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Taux de victoires et défaites par stance",
    x = "Stance",
    y = "Proportion",
    fill = "Résultat",
    caption = "Source: Données UFC"
  ) +
  theme_minimal()
```

**Interprétation :** Ici, on peut voir qu'aucune des gardes ne garantit un taux de victoire significativement supérieur à 50%.

#### Visualisation 3 : Taux de victoire entre les gardes

Essayons donc de voir si une de ces gardes a un avantage significatif sur une autre garde.

```{r bonus}
df_filtered <- data %>%
  filter(fighter1_stance %in% c("Orthodox", "Southpaw", "Switch"),
         fighter2_stance %in% c("Orthodox", "Southpaw", "Switch"))


# Compter les matchs gagnés par Fighter1
stance_matchups <- df_filtered %>%
  group_by(fighter1_stance, fighter2_stance) %>%
  summarise(victory_count = n()) %>%
  ungroup()


# Créer toutes les confrontations
df_duels <- df_filtered %>%
  mutate(matchup = paste(pmin(fighter1_stance, fighter2_stance),
                         pmax(fighter1_stance, fighter2_stance),
                         sep = " vs "))

# Total de combats par matchup
total_fights <- df_duels %>%
  group_by(matchup) %>%
  summarise(total = n())

# Victoires par combinaison exacte
wins <- df_duels %>%
  group_by(fighter1_stance, fighter2_stance) %>%
  summarise(victory = n()) %>%
  mutate(matchup = paste(pmin(fighter1_stance, fighter2_stance),
                         pmax(fighter1_stance, fighter2_stance),
                         sep = " vs ")) %>%
  left_join(total_fights, by = "matchup") %>%
  mutate(victory_rate = victory / total)

# Pour affichage correct dans la heatmap
wins_plot <- wins %>%
  select(fighter1_stance, fighter2_stance, victory_rate)

ggplot(wins_plot, aes(x = fighter2_stance, y = fighter1_stance, fill = victory_rate)) +
  geom_tile(color = "white") +
  geom_text(aes(label = scales::percent(victory_rate, accuracy = 1)), color = "black", size = 4) +
  scale_fill_gradient(low = "white", high = "darkgreen") +
  labs(
    title = "Taux de victoire par combinaison de garde",
    subtitle = "Pourcentage de victoires du combattant 1 face au combattant 2",
    x = "Garde de l'adversaire",
    y = "Garde du gagnant",
    fill = "Taux de victoire",
    caption = "Source: Données UFC"
  ) +
  theme_minimal()
```

**Interpretation :** Aucune domination significative ne peut être notée. Il semble que la garde n'est pas l'élément qui influence le plus l'issue d'un combat.

##### Conclusion question 3
Finalement, on pourrait considérer la garde orhtodox comme étant la meilleure garde à utiliser. 
Bien qu'elle possède le même taux de réussite que les autres gardes, elle est tout de même beaucoup plus utilisée. Cela veut donc dire que numériquement elle permet à un nombre important de combattants de remporter leur combat.
Une analyse plus profonde serait d'étudier les gardes utilisées selon le niveau des combattants.



### Question 4 : Les notions de favori et d’underdog sont-elles respectées réellement ? Les bookmakers ont-ils raison ?

Commençons par nettoyer le dataset pour cette question. Nous avons besoin des combats où les cotes sont existantes et le resultat l'est aussi.

```{r data_load}

odds_df <- data %>%
  filter(
    !is.na(favourite_odds),
    !is.na(underdog_odds),
    betting_outcome %in% c("favourite", "underdog")
  )
```


#### Visualisation 1 : 

Intuitivement, nous nous attendons à ce que les favoris remportent la majorité des combats, sinon les cotes n'auraient pas de sens. 

```{r victory_summary}
win_summary <- odds_df %>%
  count(betting_outcome) %>%
  mutate(
    percent = n / sum(n) * 100,
    label = str_c(n, " (", round(percent, 1), "%)")
  )

ggplot(win_summary, aes(x = betting_outcome, y = n, fill = betting_outcome)) +
  geom_col(width = 0.6, show.legend = FALSE) +
  scale_x_discrete(labels = c("favourite" = "Favori", "underdog" = "Underdog")) +
  scale_fill_manual(
    values = c("favourite" = "#1f77b4", "underdog" = "#ff7f0e")
  ) +
  labs(
    title = "Nombre de victoires : Favori vs Underdog",
    subtitle = str_c(
      "Total combats = ", sum(win_summary$n),
      "  ·  ",
      "Prédiction correcte = ", win_summary$label[win_summary$betting_outcome == "favourite"]
    ),
    x = "",
    y = "Nombre de combats",
    caption = "Source: Données UFC"
  ) +
  geom_text(aes(label = label), vjust = -0.5) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12),
    axis.text.x = element_text(face = "bold")
  )
```

**Interprétation :** Le graphique montre clairement que les favoris remportent environ 65% des combats, contre 35% pour les underdogs. Cette différence significative confirme que les bookmakers ont globalement raison dans leurs prédictions. Un taux de précision de 65% est considérable dans un sport aussi imprévisible que le MMA, où un seul coup peut changer l'issue d'un combat, néanmoins il aurait été facile d'imaginer que ce nombre soit plus grand. 
En effet, le fait que les underdogs gagnent dans plus d'un tiers des cas soulève une question intéressante: existe-t-il des situations particulières où les underdogs ont plus de chances de l'emporter ?

#### Visualisation 2 : Relation entre côtes et durée du combat

Nous cherchons à quantifier cette tendance. Nous avons déja tracé précédemment la durée moyenne des combats (qui était de 3 rounds), y a t-il une différence majeure si l'on prend en considération les côtes ?
Ici, on s'attendrait à ce que les combats soient plus longs si les côtes étaient hautes (adversaires égaux). 

```{r favourite_rounds_stacked_barplot}

# Préparation des données pour le graphique
odds_df_summary_fav <- odds_df %>%
  filter(betting_outcome == "favourite", favourite_odds <= 2, favourite_odds >= 1.0, !is.na(round)) %>%
  mutate(
    odds_category = cut(
      favourite_odds,
      breaks = seq(1.0, 2.0, by = 0.2),
      include.lowest = TRUE,
      right = TRUE,
      labels = c("1.0-1.2", "1.2-1.4", "1.4-1.6", "1.6-1.8", "1.8-2.0")
    ),
    round = as.factor(round) # Traiter round comme un facteur pour la coloration et l'empilement
  ) %>%
  filter(!is.na(odds_category)) %>%
  count(odds_category, round, name = "n_combats") %>% # Compter les combats par catégorie de cote et round
  group_by(odds_category) %>%
  mutate(proportion = n_combats / sum(n_combats)) %>% # Calculer la proportion
  ungroup()

# Création du diagramme en barres empilées normalisées pour les favoris
ggplot(odds_df_summary_fav, aes(x = odds_category, y = proportion, fill = round)) +
  geom_col(position = "fill", width = 0.7) + 
  geom_text(
    aes(label = ifelse(proportion > 0.03, scales::percent(proportion, accuracy = 1), "")), # Seuil ajusté si besoin 
    position = position_fill(vjust = 0.5),
    size = 3.5,
    color = "white",
    fontface = "bold"
  ) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_brewer(palette = "Blues", direction = -1, name = "Round de fin") + # Palette Blues, direction pour l'ordre
  labs(
    title = "Répartition des rounds de fin par catégorie de cote du favori (Favoris gagnants)",
    subtitle = "Pour les combats où le favori a gagné (cote du favori ≤ 2.0)",
    x = "Catégorie de cote du favori",
    y = "Proportion des combats",
    caption = "Source: Données UFC"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5, margin = margin(b = 15)),
    axis.title.x = element_text(face = "bold", margin = margin(t = 10)),
    axis.title.y = element_text(face = "bold", margin = margin(r = 10)),
    axis.text.x = element_text(size = 11),
    legend.title = element_text(face = "bold"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.y = element_blank()
  )
```

```{r underdog_rounds_stacked_barplot}
# Préparation des données pour le graphique des underdogs
odds_df_summary_und <- odds_df %>%
  filter(betting_outcome == "underdog", favourite_odds <= 2, favourite_odds >= 1.0, !is.na(round)) %>% # On garde favourite_odds pour la catégorisation
  mutate(
    odds_category = cut(
      favourite_odds, # Catégorisation basée sur la cote du favori, même si l'underdog gagne
      breaks = seq(1.0, 2.0, by = 0.2),
      include.lowest = TRUE,
      right = TRUE,
      labels = c("1.0-1.2", "1.2-1.4", "1.4-1.6", "1.6-1.8", "1.8-2.0")
    ),
    round = as.factor(round)
  ) %>%
  filter(!is.na(odds_category)) %>%
  count(odds_category, round, name = "n_combats") %>%
  group_by(odds_category) %>%
  mutate(proportion = n_combats / sum(n_combats)) %>%
  ungroup()

# Création du diagramme en barres empilées normalisées pour les underdogs
ggplot(odds_df_summary_und, aes(x = odds_category, y = proportion, fill = round)) +
  geom_col(position = "fill", width = 0.7) +
  geom_text(
    aes(label = ifelse(proportion > 0.03, scales::percent(proportion, accuracy = 1), "")), # Seuil ajusté si besoin
    position = position_fill(vjust = 0.5),
    size = 3.5,
    color = "white",
    fontface = "bold"
  ) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_brewer(palette = "Oranges", direction = -1, name = "Round de fin") + # Palette Oranges, direction pour l'ordre
  labs(
    title = "Répartition des rounds de fin par catégorie de cote du favori (Underdogs gagnants)",
    subtitle = "Pour les combats où l'underdog a gagné (cote du favori ≤ 2.0)",
    x = "Catégorie de cote du favori",
    y = "Proportion des combats",
    caption = "Source: Données UFC"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5, margin = margin(b = 15)),
    axis.title.x = element_text(face = "bold", margin = margin(t = 10)),
    axis.title.y = element_text(face = "bold", margin = margin(r = 10)),
    axis.text.x = element_text(size = 11),
    legend.title = element_text(face = "bold"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.y = element_blank()
  )
```

```{r underdog_odds_barplot_percentage}
# Préparation des données pour le graphique des underdogs (normalisé)
odds_df_summary_und <- odds_df %>%
  filter(
    betting_outcome == "underdog",
    favourite_odds <= 2, favourite_odds >= 1.0
  ) %>%
  mutate(
    odds_category = cut(
      favourite_odds,
      breaks = seq(1.0, 2.0, by = 0.2),
      include.lowest = TRUE,
      right = TRUE,
      labels = c("1.0-1.2", "1.2-1.4", "1.4-1.6", "1.6-1.8", "1.8-2.0")
    )
  ) %>%
  filter(!is.na(odds_category)) %>%
  count(odds_category, name = "n_combats") %>%
  mutate(percent_combats = n_combats / sum(n_combats) * 100)

ggplot(odds_df_summary_und, aes(x = odds_category, y = percent_combats)) +
  geom_col(fill = "#ff7f0e", width = 0.7) +
  geom_text(aes(label = paste0(round(percent_combats, 1), "%")),
            vjust = -0.5, size = 4) +
  labs(
    title = "Pourcentage de victoires des underdogs selon la cote du favori",
    subtitle = "Pour les combats où l'underdog a gagné (cote du favori ≤ 2.0)",
    x = "Catégorie de cote du favori",
    y = "Pourcentage de victoires underdog",
    caption = "Source: Données UFC"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5, margin = margin(b = 15)),
    axis.title.x = element_text(face = "bold", margin = margin(t = 10)),
    axis.title.y = element_text(face = "bold", margin = margin(r = 10)),
    axis.text.x = element_text(size = 11)
  )
```

**Interprétation :**

Ces trois graphiques illustrent la répartition des issues de combat en fonction des cotes, en se concentrant sur le round de fin et la fréquence des victoires des underdogs.

*   **Graphique 1 (Favoris gagnants) :**
    On observe une tendance où la proportion des combats se terminant au **Round 3** augmente légèrement à mesure que la cote du favori se rapproche de 2.0 (matchs perçus comme plus équilibrés). Par exemple, pour les cotes entre 1.0-1.2, environ 41% des victoires des favoris se font au Round 3, tandis que cette proportion monte à 58% pour les cotes de 1.4-1.6 et se maintient à ce niveau. Inversement, la proportion de victoires au **Round 1** diminue lorsque les cotes augmentent (passant de 30% à environ 21-24%). Cela suggère que lorsque le favori est très largement attendu gagnant (cote basse), il a une plus grande probabilité de finir le combat rapidement. Lorsque l'opposition est plus équilibrée (cote plus élevée), les combats ont tendance à durer plus longtemps, souvent jusqu'au Round 3. Les fins aux rounds 4 et 5 restent minoritaires mais sont visibles.

*   **Graphique 2 (Underdogs gagnants) :**
    Lorsque les underdogs gagnent, on note également que la proportion de victoires au **Round 3** est majoritaire et tend à augmenter avec la cote du favori (passant de 38% pour les cotes 1.0-1.2 à environ 57-60% pour les cotes plus élevées du favori). Cela signifie que même quand un underdog déjoue les pronostics face à un favori dont la cote était élevée (match supposé plus serré), le combat va souvent jusqu'au 3ème round.
    Fait intéressant, la proportion de victoires des underdogs au **Round 1** est assez conséquente (autour de 33% lorsque le favori a une cote très basse 1.0-1.2, et 22-27% pour les cotes plus élevées). Cela pourrait indiquer que les underdogs capitalisent sur un effet de surprise ou une erreur précoce du favori pour obtenir une victoire rapide, surtout quand ils sont largement donnés perdants.

*   **Graphique 3 (Proportion des victoires des underdogs) :**
    Ce graphique met en contexte les victoires des underdogs. Il montre que la grande majorité des "surprises" se produisent lorsque les combats sont déjà perçus comme relativement serrés. En effet, **36%** de toutes les victoires d'underdogs ont lieu lorsque la cote du favori est entre 1.6 et 1.8. À l'inverse, les véritables exploits contre des favoris écrasants (cote de 1.0-1.2) ne représentent que **2%** des victoires d'underdogs. Cela confirme que si les upsets sont possibles, ils sont beaucoup plus probables lorsque les niveaux des combattants sont jugés proches par les bookmakers. Cela atténue aussi le fait que les underdogs peuvent gagner rapidement le combat au final.

En combinant les informations, on peut conclure que le Round 3 est un moment clé, surtout dans les combats équilibrés, que le favori ou l'underdog l'emporte. Les favoris très marqués ont tendance à finir les combats plus tôt (Round 1). Les underdogs, quant à eux, gagnent le plus souvent lorsque le combat est déjà annoncé comme serré. Cependant, lorsqu'ils créent une grosse surprise contre un grand favori, ils le font de manière disproportionnée au Round 1, capitalisant probablement sur un KO ou une soumission rapide.

#### Visualisation 3 : Précision des cotes

Nous cherchons maintenant à voir la précision des cotes. En moyenne, avoir une cote plus basse signifie-t-il effectivement avoir plus de chances de gagner ?
Bien évidemment, c'est ce qui est attentue.

```{r odds_accuracy}
# Taux de réussite par cotes
odds_df <- odds_df %>%
  mutate(cote_bin = case_when(
    favourite_odds > 2 ~ "Plus de 2.0",
    favourite_odds >= 1.8 ~ "1.8 à 2.0",
    favourite_odds >= 1.6 ~ "1.6 à 1.8",
    favourite_odds >= 1.4 ~ "1.4 à 1.6",
    favourite_odds >= 1.2 ~ "1.2 à 1.4",
    TRUE ~ "1.0 à 1.2"
  ))

winrate_df <- odds_df %>%
  group_by(cote_bin) %>%
  summarise(
    total = n(),
    wins = sum(betting_outcome == "favourite"),
    winrate = wins / total
  ) %>%
  filter(!is.na(cote_bin)) %>%
  mutate(
    label = paste0("(", total, " combats)")
  )

ggplot(winrate_df, aes(x = factor(cote_bin, levels = c("1.0 à 1.2", "1.2 à 1.4", "1.4 à 1.6", "1.6 à 1.8", "1.8 à 2.0", "Plus de 2.0")), y = winrate)) +
  geom_col(fill = "#1f77b4", alpha = 0.8) +
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "red") +
  geom_text(aes(label = label), vjust = -0.5, size = 3) +
  labs(
    title = "Taux de victoire du favori selon la cote",
    x = "Cote du favori",
    y = "Taux de victoire",
    caption = "Source: Données UFC"
  ) +
  theme_minimal(base_size = 14) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

**Interprétation :** On observe bien une pente plus ou moins linéaire. Plus la côte augmente et moins il y a de chances de gagner, se rapprochant même à 50% sur les cotes qui tendent vers 2. 
Les combat où le favori a une cote de plus de 2 ont un taux de victoire supérieur aux combats entre 1.8 et 2. Cette différence vient surêment du peu de combat où le favori a une cote aussi élévé. Le résultat est alors légerement biaisé, mais la visualisation confirme l'hypothèse.


##### Conclusion question 4
Les favoris remportent environ **65% des combats**, ce qui confirme que les bookmakers ont globalement raison dans leurs prédictions. Cependant, les underdogs gagnent dans plus d’un tiers des cas, ce qui montre que le MMA reste un sport imprévisible. De plus, les cotes reflètent bien les probabilités de victoire, avec une corrélation claire entre des cotes plus basses et un taux de victoire plus élevé.


### Question 5 : Existe-t-il des profils de combattant différents selon les régions du monde ?

Le MMA puise ses techniques dans diverses disciplines traditionnelles propres à différentes cultures. Il est donc logique de se demander si les combattants de différentes régions du monde développent des profils de combat distincts, reflétant les traditions martiales de leur origine géographique.

Nous nous attendons à observer des spécialisations régionales : par exemple, les combattants russes pourraient exceller dans les projections (influence de la lutte et du sambo), tandis que d'autres régions pourraient privilégier le striking.

#### Visualisation 1 : Distribution des tentatives de projection et défense contre les projections

Commençons par examiner trois variables clés qui illustrent l'approche tactique des combattants : les tentatives de projection, la défense contre les projections, et les frappes significatives touchées par région.

```{r preparation_donnees_q5}
fighters <- read_csv("data/pro_mma_fighters.csv")
# Standardiser les noms
fighters <- fighters %>% 
  mutate(fighter_name = str_to_lower(fighter_name))

ufc <- data %>% 
  mutate(fighter1 = str_to_lower(fighter1), 
         fighter2 = str_to_lower(fighter2))

fighters_unique <- fighters %>% 
  distinct(fighter_name, .keep_all = TRUE)

ufc_geo <- ufc %>% 
  left_join(fighters_unique %>% select(fighter_name, country), 
            by = c("fighter1" = "fighter_name")) %>%
  rename(fighter1_country = country) %>%
  left_join(fighters_unique %>% select(fighter_name, country), 
            by = c("fighter2" = "fighter_name")) %>%
  rename(fighter2_country = country)

# Regroupement par région
get_region <- function(country) {
  if (country %in% c("Russia")) return("Russie")
  else if (country %in% c("Brazil", "Argentina", "Peru", "Chile", "Colombia")) return("Amérique du Sud")
  else if (country %in% c("USA", "Canada", "Mexico")) return("Amérique du Nord")
  else if (country %in% c("UK", "France", "Germany", "Spain", "Poland", "Sweden", "Netherlands", "Italy")) return("Europe")
  else if (country %in% c("Japan", "China", "South Korea", "India", "Thailand", "Philippines")) return("Asie (hors Russie)")
  else return(NA)
}

ufc_geo <- ufc_geo %>%
  mutate(fighter1_region = sapply(fighter1_country, get_region),
         fighter2_region = sapply(fighter2_country, get_region))

# Préparation des données pour l'analyse
fighter1_stats <- ufc_geo %>%
  select(starts_with("fighter1_")) %>%
  rename_with(~ str_replace(., "fighter1_", ""), everything()) %>%
  mutate(fighter = "fighter1")

fighter2_stats <- ufc_geo %>%
  select(starts_with("fighter2_")) %>%
  rename_with(~ str_replace(., "fighter2_", ""), everything()) %>%
  mutate(fighter = "fighter2")

all_stats <- bind_rows(fighter1_stats, fighter2_stats) %>%
  filter(!is.na(region))

# Variables d'analyse avec noms français
variables <- c(
  "sig_strikes_landed_pm", 
  "sig_strikes_accuracy", 
  "takedown_avg_per15m",
  "sig_strikes_absorbed_pm", 
  "sig_strikes_defended", 
  "takedown_defence"
)

# Noms français pour les variables
var_names_fr <- c(
  "sig_strikes_landed_pm" = "Frappes signif. touchées/min",
  "sig_strikes_accuracy" = "Précision frappes signif. (%)",
  "takedown_avg_per15m" = "Tentatives de projection/15min",
  "sig_strikes_absorbed_pm" = "Frappes signif. subies/min",
  "sig_strikes_defended" = "Défense frappes signif. (%)",
  "takedown_defence" = "Défense projections (%)"
)

# Palette de couleurs pour les régions
regions <- unique(all_stats$region[!is.na(all_stats$region)])
colors <- RColorBrewer::brewer.pal(min(length(regions), 8), "Set2")
region_colors <- setNames(colors[1:length(regions)], regions)
```


```{r projection_analysis}
# Box plots pour les tentatives de projection
p1 <- ggplot(all_stats, aes(x = region, y = takedown_avg_per15m, fill = region)) +
  geom_boxplot(color = "black", alpha = 0.7) +
  scale_fill_manual(values = region_colors, name = "Région") +
  theme_minimal() +
  labs(
    title = "Distribution des tentatives de projection par région",
    x = "Région",
    y = "Tentatives de projection/15min",
    caption = "Source: Données UFC"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
    plot.title = element_text(size = 12, face = "bold"),
    legend.position = "none"
  )

# Box plots pour la défense contre les projections
p2 <- ggplot(all_stats, aes(x = region, y = takedown_defence, fill = region)) +
  geom_boxplot(color = "black", alpha = 0.7) +
  scale_fill_manual(values = region_colors, name = "Région") +
  theme_minimal() +
  labs(
    title = "Distribution de la défense contre les projections par région",
    x = "Région",
    y = "Défense projections (%)",
    caption = "Source: Données UFC"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
    plot.title = element_text(size = 12, face = "bold"),
    legend.position = "none"
  )

# Box plots pour la défense contre les projections
p3 <- ggplot(all_stats, aes(x = region, y = sig_strikes_landed_pm, fill = region)) +
  geom_boxplot(color = "black", alpha = 0.7) +
  scale_fill_manual(values = region_colors, name = "Région") +
  theme_minimal() +
  labs(
    title = "Distribution des frappes significatives touchées par région",
    x = "Région",
    y = "Frappes signif. touchées/min",
    caption = "Source: Données UFC"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
    plot.title = element_text(size = 12, face = "bold"),
    legend.position = "none"
  )

print(p1)
print(p2)
print(p3)
```

**Interprétation :** Les 2 premiers box plots révèlent des différences tactiques marquées selon les régions. La Russie se distingue nettement avec des valeurs supérieures tant pour les tentatives de projection que pour leur défense, confirmant notre hypothèse sur l'influence des traditions de lutte et de sambo dans le style russe. Cette spécialisation dans le grappling contraste avec les autres régions qui présentent des profils plus homogènes entre elles. Ces résultats confirment l'existence de spécialisations régionales distinctes, la Russie étant clairement orientée grappling tandis que les autres régions développent des styles plus équilibrés. Le dernier box plot concerne le striking, et les valeurs semblent bien plus équilibrées selon la région, on ne peut pas assurément observer une tendance. Seule l'Asie hors Russie est en retrait (on y retouve surtout des pays d'extreme orient.) 

#### Visualisation 2 : Profils radar par région

Pour avoir une vision d'ensemble des différents profils de combattants, utilisons des graphiques radar qui permettent de comparer simultanément toutes les variables techniques.On pourra ainsi définir le profil type d'un combattant en fonction de sa région.

```{r radar_charts_by_region}

library(fmsb)
# Calcul des moyennes par région
region_means <- all_stats %>%
  group_by(region) %>%
  summarise(across(all_of(variables), ~ mean(.x, na.rm = TRUE))) %>%
  na.omit()

# Créer une version avec numéros pour l'affichage
region_means_numbered <- region_means
colnames(region_means_numbered)[2:ncol(region_means_numbered)] <- paste0("V", 1:length(variables))

# Variables pour le radar chart (avec numéros)
radar_vars_numbered <- paste0("V", 1:length(variables))

# Créer la légende des variables
legend_text <- paste0(1:length(variables), ". ", var_names_fr[variables])

# Graphique radar combiné pour toutes les régions
max_min <- rbind(
  apply(region_means_numbered[radar_vars_numbered], 2, max),
  apply(region_means_numbered[radar_vars_numbered], 2, min)
)

# Configuration des graphiques
par(mfrow = c(2,3))
par(mar = c(1, 1, 3, 1))
par(oma = c(5, 0, 0, 0))   

# Un graphique par région
for (i in 1:nrow(region_means_numbered)) {
  region_name <- region_means_numbered$region[i]
  data_row <- region_means_numbered[i, radar_vars_numbered]
  
  # Ajouter les lignes max et min pour normaliser le radar chart
  chart_data <- rbind(max_min, data_row)
  rownames(chart_data) <- c("Max", "Min", region_name)
  
  radarchart(
    chart_data,
    axistype = 1,
    pcol = region_colors[region_name],
    pfcol = scales::alpha(region_colors[region_name], 0.4),
    plwd = 3,
    title = paste("Profil des combattants –", region_name),
    cglcol = "grey",
    cglty = 1,
    cglwd = 0.8,
    axislabcol = "grey",
    vlcex = 1.5,
    calcex = 0.9,
    cex.main = 1.3
  )
}

# Créer un graphique vide pour la légende
plot(1, type = "n", axes = FALSE, xlab = "", ylab = "", main = "Légende des variables")

# Ajouter la légende
legend("center", 
       legend = legend_text,
       bty = "n",
       cex = 1.2,
       col = "black")
mtext("Source : Données UFC", side = 1, line = 4, cex = 0.8, outer = TRUE)
```

**Interprétation :** Les graphiques radar, présentés en pourcentages relatifs par rapport à la meilleure région pour chaque variable, révèlent des profils de combat distincts. La Russie confirme sa spécialisation grappling avec des valeurs maximales en tentatives de projection (V3) et défense projections (V6), formant un radar caractéristique étendu sur ces axes, mais aussi en striking, ce qui en fait la région la plus complète. L'Amérique du Nord présente un profil plus équilibré avec des forces particulières en frappes significatives touchées (V1), suggérant une approche plus orientée striking, mais des valeurs faibles en terme de projections. L'Amérique du Sud montre un profil equilibré avec des valeurs moyennes partout, mais ce sont ceux avec l'Amérique du Nord qui subissent le plus de coups. L'Europe affiche un profil orienté striking et offensif, avec les valeurs maximales en frappes touchées et en précision. Enfin, l'Asie affiche un profil plus faible, sans réelle force.

#### Visualisation 3 : Analyse comparative des styles offensifs vs défensifs

Enfin, pour approfondir l'analyse, examinons la relation entre les capacités offensives et défensives de chaque région sur un scatter plot. On pourra mettre en lien toutes les variables offensives et défensives selon la région pour avoir une vue globale de chaque région par rapport aux autres.

```{r offensive_defensive_comparison}
# Calculer les moyennes par région pour analyse offensive/défensive
region_summary <- all_stats %>%
  group_by(region) %>%
  summarise(
    offensive_striking = mean(sig_strikes_landed_pm, na.rm = TRUE),
    defensive_striking = mean(sig_strikes_defended, na.rm = TRUE),
    offensive_grappling = mean(takedown_avg_per15m, na.rm = TRUE),
    defensive_grappling = mean(takedown_defence, na.rm = TRUE),
    .groups = 'drop'
  )

# Déterminer les marges dynamiques
x_margin <- (max(region_summary$offensive_striking) - min(region_summary$offensive_striking)) * 0.1
y_margin <- (max(region_summary$defensive_striking) - min(region_summary$defensive_striking)) * 0.1

# Graphique scatter offensif vs défensif
ggplot(region_summary, aes(x = offensive_striking, y = defensive_striking)) +
  geom_point(aes(color = region, size = offensive_grappling), alpha = 0.8) +
  geom_text(aes(label = region), vjust = -1.5, size = 3) +
  scale_color_manual(values = region_colors, name = "Région") +
  scale_size_continuous(name = "Projections/15min", range = c(3, 8)) +
  labs(
    title = "Profils offensifs vs défensifs par région",
    subtitle = "La taille des points représente les tentatives de projection",
    x = "Frappes significatives touchées/min (Offensif)",
    y = "Défense frappes significatives % (Défensif)",
    caption = "Source: Données UFC"
  ) +
  coord_cartesian(
    xlim = c(min(region_summary$offensive_striking) - x_margin,
             max(region_summary$offensive_striking) + x_margin),
    ylim = c(min(region_summary$defensive_striking) - y_margin,
             max(region_summary$defensive_striking) + y_margin)
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    legend.position = "bottom"
  )

```

**Interprétation :** Ainsi, cette visualisation confirme bien nos hypothèses traitées durant la question. La Russie est une région bien plus forte que ce soit offensivement ou défensivement, en terme de projection ou de striking. L'Europe a un profil particulièrement offensif, en étant en avance sur les frappes significatives touchées. Enfin, l'Asie est bien en retrait, confirmant ce qu'on a pu voir sur les radar charts.

##### Conclusion question 5

L’analyse révèle des différences marquées dans les profils de combattants selon les régions du monde, confirmant l’hypothèse de spécialisations régionales influencées par les traditions martiales locales. La Russie se distingue nettement par un style orienté grappling, avec une fréquence élevée de tentatives de projection et une solide défense au sol, reflet de l’influence du sambo et de la lutte. L’Europe se montre plus offensive dans le striking, avec une précision et une intensité de frappes significatives particulièrement élevées. L’Amérique du Nord adopte un profil équilibré, performant en striking mais moins actif au sol, tandis que l’Amérique du Sud présente un style intermédiaire tout en étant vulnérable défensivement. Enfin, l’Asie (hors Russie) apparaît globalement en retrait, sans domaine de prédilection affirmé. Ces résultats illustrent l’impact des écoles de formation régionales et des disciplines de combat traditionnelles sur les styles modernes en MMA.

### Question 6 : Quels facteurs peuvent influencer considérablement la durée de carrière d’un combattant ?

Cette question vise à identifier les variables ayant un impact significatif sur la longévité des combattants dans l'UFC. Nous analysons différents aspects physiques, tactiques et performatifs pour comprendre ce qui détermine une carrière durable.

Commençons par pré-traité nos données pour avoir la durée de carrière de chaque combattant. Nous faisons le lien entre les deux datasets pour et gardons seulement les combattants dont on a la date de naissance. 

```{r q6_pretraitement}
library(dplyr)
library(lubridate)
library(ggplot2)
library(corrplot)

fighters_pro <- read.csv("data/pro_mma_fighters.csv")
ufc_data <- read.csv("data/complete_ufc_data.csv")


# convertir les colonnes de dates
fighters_pro$birth_date <- dmy(fighters_pro$birth_date, quiet = TRUE)
ufc_data$event_date <- ymd(ufc_data$event_date, quiet = TRUE)
ufc_data$fighter1_dob <- ymd(ufc_data$fighter1_dob, quiet = TRUE)
ufc_data$fighter2_dob <- ymd(ufc_data$fighter2_dob, quiet = TRUE)

# créer une table longue pour les combattants et leurs combats à partir de ufc_data
fights_fighter1 <- ufc_data %>%
  select(event_date, fighter = fighter1, opponent = fighter2, weight_class, method, outcome,
         sig_strikes_landed_pm = fighter1_sig_strikes_landed_pm,
         sig_strikes_absorbed_pm = fighter1_sig_strikes_absorbed_pm,
         height = fighter1_height, dob = fighter1_dob, rounds = round) %>% 
  mutate(
    win = ifelse(outcome == "fighter1", 1, 0),
    loss = ifelse(outcome == "fighter2", 1, 0),
    draw = ifelse(outcome == "Draw", 1, 0),
    no_contest = ifelse(outcome == "No contest", 1, 0),
    ko_suffered = ifelse(outcome == "fighter2" & grepl("KO/TKO", method, ignore.case = TRUE), 1, 0)
  )

fights_fighter2 <- ufc_data %>%
  select(event_date, fighter = fighter2, opponent = fighter1, weight_class, method, outcome,
         sig_strikes_landed_pm = fighter2_sig_strikes_landed_pm,
         sig_strikes_absorbed_pm = fighter2_sig_strikes_absorbed_pm,
         height = fighter2_height, dob = fighter2_dob, rounds = round) %>%
  mutate(
    win = ifelse(outcome == "fighter2", 1, 0),
    loss = ifelse(outcome == "fighter1", 1, 0),
    draw = ifelse(outcome == "Draw", 1, 0),
    no_contest = ifelse(outcome == "No contest", 1, 0),
    ko_suffered = ifelse(outcome == "fighter1" & grepl("KO/TKO", method, ignore.case = TRUE), 1, 0)
  )

all_fights <- bind_rows(fights_fighter1, fights_fighter2) %>%
  filter(!is.na(fighter) & fighter != "" & !is.na(event_date)) %>%
  mutate(weight_class = factor(weight_class)) # convertir weight_class en facteur pour l'agrégation

# agréger les données par combattant
fighter_stats <- all_fights %>%
  group_by(fighter) %>% # utiliser le nom du combattant pour grouper
  summarise(
    first_fight_date = min(event_date, na.rm = TRUE),
    last_fight_date = max(event_date, na.rm = TRUE),
    num_fights = n(),
    total_wins = sum(win, na.rm = TRUE), 
    total_losses = sum(loss, na.rm = TRUE),
    total_draws = sum(draw, na.rm = TRUE), 
    total_ko_suffered = sum(ko_suffered, na.rm = TRUE),
    avg_sig_strikes_absorbed_pm = mean(sig_strikes_absorbed_pm, na.rm = TRUE),
    total_sig_strikes_absorbed = sum(sig_strikes_absorbed_pm * ifelse(is.na(rounds), 0, rounds) * 5, na.rm = TRUE),
    avg_height_cm = mean(height, na.rm = TRUE),
    dob_from_ufc = first(na.omit(dob)),
    # Prendre la catégorie de poids la plus fréquente pour le combattant
    main_weight_class = if (n() > 0) names(which.max(table(na.omit(weight_class)))) else NA,
    total_rounds_fought = sum(rounds, na.rm = TRUE)
  ) %>%
  filter(is.finite(first_fight_date) & is.finite(last_fight_date) & num_fights > 0)


# joindre avec les informations de pro_mma_fighters pour la date de naissance
fighters_pro_dob <- fighters_pro %>% select(fighter_name, pro_dob = birth_date)

fighter_stats <- fighter_stats %>%
  left_join(fighters_pro_dob, by = c("fighter" = "fighter_name"))

# Combiner les dates de naissance
fighter_stats <- fighter_stats %>%
  mutate(
    final_dob = if_else(!is.na(dob_from_ufc), dob_from_ufc, pro_dob),
    final_dob = as_date(final_dob)
  ) %>%
  filter(!is.na(final_dob)) # garder uniquement les combattants avec une date de naissance

# calculer la durée de carrière et les âges
fighter_stats <- fighter_stats %>%
  mutate(
    career_duration_days = as.numeric(last_fight_date - first_fight_date),
    career_duration_years = career_duration_days / 365.25,
    age_at_first_fight = as.numeric(first_fight_date - final_dob) / 365.25,
    age_at_last_fight = as.numeric(last_fight_date - final_dob) / 365.25,
    avg_career_age = (age_at_first_fight + age_at_last_fight) / 2
  ) %>%
  filter(career_duration_years >= 0 & age_at_first_fight > 0 & age_at_last_fight > 0) # filtrer les données incohérentes

# calculer la fréquence des combats et autres taux
fighter_stats <- fighter_stats %>%
  mutate(
    fight_frequency_per_year = ifelse(career_duration_years > 0, num_fights / career_duration_years, 0),
    win_rate = ifelse(num_fights > 0, total_wins / num_fights, 0),
    loss_rate = ifelse(num_fights > 0, total_losses / num_fights, 0),
    ko_suffered_per_fight = ifelse(num_fights > 0, total_ko_suffered / num_fights, 0),
    avg_rounds_fought = ifelse(num_fights > 0, total_rounds_fought / num_fights, 0)
  )

weight_order <- c("Women's Strawweight", "Women's Flyweight", "Women's Bantamweight", "Women's Featherweight",
                  "Flyweight", "Bantamweight", "Featherweight", "Lightweight",
                  "Welterweight", "Middleweight", "Light Heavyweight", "Heavyweight", "Catch Weight") 

fighter_stats <- fighter_stats %>%
  mutate(
    main_weight_class = factor(main_weight_class, levels = weight_order, ordered = TRUE),
    weight_class_numeric = as.numeric(main_weight_class)
  )

# S'assurer que les données nécessaires sont disponibles et sans NA/Inf pour les graphiques
plot_data_base <- fighter_stats %>%
  filter(
    is.finite(career_duration_years),
    is.finite(avg_sig_strikes_absorbed_pm),
    is.finite(fight_frequency_per_year),
    !is.na(main_weight_class),
    is.finite(win_rate),
    is.finite(ko_suffered_per_fight)
  )
```

Maintenons nous pouvons traiter la question. 

#### Visualisation 1 : Analyse des corrélations entre variables

Traçons une matrice de corrélation pour pouvoir quels variables semblent les plus corrélés à la durée de carrière.

```{r correlation_analysis}
heatmap_data_updated <- fighter_stats %>%
  select(
    career_duration_years,
    age_at_first_fight,
    avg_height_cm,
    fight_frequency_per_year,
    win_rate,
    ko_suffered_per_fight,
    avg_sig_strikes_absorbed_pm,
    avg_rounds_fought,
    weight_class_numeric # Nouvelle variable
  ) %>%
  # remplacer les NaN/Inf par NA pour que complete.cases fonctionne correctement
  mutate_all(~ifelse(is.nan(.) | is.infinite(.), NA, .)) %>%
  filter(complete.cases(.)) #garder uniquement les lignes sans NA


  cor_matrix_updated <- cor(heatmap_data_updated, use = "pairwise.complete.obs")
  
  
  # générer la heatmap avec corrplot 
  corrplot(
    cor_matrix_updated,
    method = "color",
    type = "upper",
    order = "hclust",
    addCoef.col = "black",
    number.cex = 0.7,
    tl.col = "black",
    tl.srt = 45,
    tl.cex = 0.75,
    diag = FALSE,
    col = rev(colorRampPalette(c("red", "white", "blue"))(200)), 
    title = "Heatmap de Corrélation (Variables Normalisées/Pertinentes)",
    mar = c(1, 1, 2, 1)
  )
  mtext("Source : Données UFC", side = 1, line = 4, cex = 0.8)
```

**Interprétation** : La matrice de corrélation révèle plusieurs relations importantes :

- Le **taux de victoire** présente une corrélation positive notable (0.40) avec la durée de carrière, ce qui pourrait sous entendre que plus on gagne, plus on reste dans l'organisation longtemps.
- L'**âge au premier combat** montre une corrélation négative (-0.25), suggérant qu'un début tardif limite la longévité (ce qui est logique, car commencer plus tard signifie avoir moins de marge).
- La **fréquence des combats par an** est négativement corrélée (-0.21) à la durée de carrière. Faire trop de combats impacterait négativement la carrière.
- Les **KO subis par combat** présentent une corrélation négative (-0.16) avec la longévité. Les K.O. affaibliraient le combattant qui ferait une carrière plus courte.

On observe également une forte corrélation (0.80) entre la taille moyenne et la catégorie de poids, ce qui correspond à une relation totalement logique.

#### Visualisation 2 : Impact du taux de victoire

On trace donc la relation entre le taux de victoire et la durée de carrière. En filtrant ceux ayant plus de 5 combats (pour éviter l'agglomération aux bornes).

```{r victory_rate}
# filtrer pour ne garder que les combattants avec au moins 5 combats
plot_data_valid_fights <- plot_data_base %>%
  filter(num_fights >= 5)

p5 <- ggplot(plot_data_valid_fights, aes(x = win_rate, y = career_duration_years)) +
    geom_point(alpha = 0.3, shape = 16, color = "purple4") +
    geom_smooth(method = "loess", col = "seagreen", se = FALSE, span = 0.75) +
    labs(
      title = "Influence du Taux de Victoire sur la Durée de Carrière",
      subtitle = "Relation entre le pourcentage de victoires et la longévité (combattants avec ≥ 5 combats)",
      x = "Taux de Victoire (Victoires / Total Combats)",
      y = "Durée de Carrière (Années)",
      caption = "Source: Données UFC"
    ) +
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))
print(p5)
```


**Interprétation** :

Quand on regarde la relation entre taux de victoire et durée de carrière, on remarque que les carrières les plus longues ne sont pas forcément celles des combattants avec le plus gros pourcentage de victoires. En fait, ceux qui durent le plus sont souvent ceux qui gagnent régulièrement, sans forcément tout écraser (autour de 50 à 60 % de victoires). À l’inverse, ceux qui gagnent très peu ou, au contraire, presque tout le temps, ont souvent des carrières plus courtes — parfois parce qu’ils sont encore en activité ou parce qu’ils quittent vite l’UFC (soit parce qu’ils dominent et partent ailleurs, soit parce qu’ils enchaînent les défaites). Pour durer, il vaut mieux être solide et constant que trop irrégulier, et accumuler les victoires aide clairement à rester plus longtemps dans l’organisation.

Il y a quelques points qui se démarquent, les combattants ayant 0 victoires mais de longues carrières.

```{r worst_fighters}
worst_fighters_data <- fighter_stats %>%
  filter(total_wins == 0, num_fights > 0) %>%
  filter(is.finite(total_losses) & total_losses > 0) %>% # S'assurer qu'ils ont des défaites
  filter(is.finite(career_duration_years) & career_duration_years >= 0) %>%
  arrange(desc(total_losses), desc(career_duration_years)) %>% # Trier par PLUS de défaites, puis par durée de carrière la plus longue
  mutate(fighter_label = paste0(fighter, " (", num_fights, " combats)")) %>%
  head(5) # Prendre les 5 premiers pour la lisibilité du graphique

max_career_duration_worst = max(worst_fighters_data$career_duration_years, na.rm = TRUE)
  
p_worst_fighters <- ggplot(worst_fighters_data, 
                               aes(y = reorder(fighter_label, desc(total_losses) * 1e6 + career_duration_years), # Ajustement du reorder pour refléter le tri
                                   x = career_duration_years)) +
      geom_col(fill = "firebrick", show.legend = FALSE) +
      geom_text(aes(label = paste(total_losses, "déf.")), 
                hjust = -0.2, size = 3.5, color = "black") +
      labs(
        title = "Top 5 des Combattants avec 0 Victoire",
        subtitle = "Triés par nombre de défaites (décroissant) puis par durée de carrière (décroissante).",
        y = "Combattant (Nombre total de combats)",
        x = "Durée de Carrière (Années)",
        caption = "Source: Données UFC"
      ) +
      theme_bw() +
      theme(
        axis.text.y = element_text(size = 10),
        plot.title = element_text(hjust = 0.5, face = "bold", size=14),
        plot.subtitle = element_text(hjust = 0.5, size = 10),
        legend.position = "none"
      ) +
      coord_cartesian(xlim = c(0, if(max_career_duration_worst > 0) max_career_duration_worst * 1.20 else 1)) 

print(p_worst_fighters)
```

La plupart de ces combattants ne sont pas mauvais mais ils ont souvent été appelé comme "remplaçant" pour des combats. On peut aussi supposer qu'ils ont été utilisé pour faire grimper la côte de certains combattants.

#### Visualisation 3 : Relation entre coups absorbés et longévité

Passons maintenant à l'impact des coups sur la durée de carrière. Ici on peut faire l'hypothèse que plus un combattant reçois de coups et plus sa carrière est courte.

```{r damage_frequency_plot}
  p1 <- ggplot(plot_data_base, aes(x = avg_sig_strikes_absorbed_pm, y = career_duration_years)) +
    geom_point(alpha = 0.3, shape = 16, color = "steelblue") +
    geom_smooth(method = "loess", col = "firebrick", se = FALSE, span = 0.75) +
    labs(
      title = "Impact des Coups Absorbés sur la Durée de Carrière",
      subtitle = "Relation entre la moyenne des coups significatifs absorbés par minute et la longévité",
      x = "Moy. Coups Significatifs Absorbés / Minute",
      y = "Durée de Carrière (Années)",
      caption = "Source: Données UFC"
    ) +
    theme_bw() +
    coord_cartesian(ylim = c(0, NA), xlim = c(0, 10)) +
    theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))
  print(p1)
```
**Interprétation** : Ce graphique montre qu’il n’y a pas de règle simple : recevoir un peu de coups ne semble pas trop nuire à la longévité, mais plus on encaisse, plus la carrière a tendance à raccourcir. Il y a donc un équilibre à trouver : rester actif sans trop s’exposer. Ceux qui encaissent beaucoup de frappes voient leur carrière écourtée, sûrement à cause des blessures ou de l’usure. À l’inverse, ceux qui prennent très peu de coups n’ont pas forcément de longues carrières non plus, peut-être parce qu’ils manquent d’expérience ou d’engagement. De ce fait, savoir limiter les dégâts tout en restant dans l’action semble être un atout pour durer à l’UFC.

Ce graphique a aussi été tracé sur Shiny. Il est possible d'afficher le graphique selon le nombre de coups significatifs absorbés par minute, mais aussi par combat et sur toute la carrière. Pour les coups par combats, bien que la courbe varie moins, la tendance est la même. Sur la carrière, il est logique que plus un combattant reste dans l'UFC et plus il recevra de coups au total. Néanmoins, le fait que la courbe ne soit pas linéaire montre que les combattants avec une carrière plus longue se prenne moins de coups sur une période donnée. 


#### Visualisation 4 : Influence du rythme des combats

Il est possible d'enchaîner directement avec le rythme des combats. On s'attend à ce que trop de combats par an fatigue le combattant et diminue sa durée de carrière.

```{r combats_frequency_plot}
plot_data_p2 <- plot_data_base %>%
  filter(!(fight_frequency_per_year == 0 & career_duration_years == 0))

p2 <- ggplot(plot_data_p2, aes(x = fight_frequency_per_year, y = career_duration_years)) +
    geom_point(alpha = 0.3, shape = 16, color = "darkgreen") +
    # Utiliser une méthode GAM au lieu de loess avec contrainte de non-négativité
    stat_smooth(method = "gam", formula = y ~ s(x), 
               col = "darkorange", se = FALSE) +
    labs(
      title = "Fréquence des Combats et Longévité de Carrière",
      subtitle = "Relation entre le nombre de combats par an et la durée totale de carrière",
      x = "Fréquence des Combats (Combats / An)",
      y = "Durée de Carrière (Années)",
      caption = "Source: Données UFC"
    ) +
    theme_bw() +
    coord_cartesian(ylim = c(0, NA), xlim = c(0, 10)) +
    theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))
  print(p2)
```

**Interprétation** : Quand on regarde la relation entre le rythme des combats et la durée de carrière, on voit qu’enchaîner trop de combats chaque année finit par raccourcir la longévité des combattants. Un peu d’activité est nécessaire pour progresser et rester dans le coup, mais à force d’accumuler les combats, on s’expose à plus de blessures et à l’usure, ce qui peut forcer à arrêter plus tôt. À l’inverse, espacer un peu ses apparitions dans l’octogone laisse le temps de récupérer, de mieux se préparer et d’éviter l’accumulation des pépins physiques. Ainsi, il faut trouver le bon équilibre entre rester actif et savoir se préserver : bien gérer son calendrier de combats est clairement un atout pour durer dans le MMA.

#### Visualisation 5 : Relation entre KO subis et longévité

Par continuité, analysons le nombre de KO par combat selon la longétivité. Pour que la visualisation soit claire, nous avons divisé les combattants en 3 catégories selon leur durée de carrière.

```{r ko_analysis}
if(nrow(plot_data_base %>% filter(is.finite(career_duration_years))) > 0) {
  quantiles_career <- quantile(plot_data_base$career_duration_years[is.finite(plot_data_base$career_duration_years)], probs = c(0.33, 0.66), na.rm = TRUE)
  
  # Formatter les quantiles pour l'affichage
  quantile_labels <- paste0("Courte: ≤ ", round(quantiles_career[1], 1), " ans, ",
                            "Moyenne: > ", round(quantiles_career[1], 1), " et ≤ ", round(quantiles_career[2], 1), " ans, ",
                            "Longue: > ", round(quantiles_career[2], 1), " ans")
  
  plot_data_longevity_cat <- plot_data_base %>%
    mutate(
      longevity_category = case_when(
        career_duration_years <= quantiles_career[1] ~ "Courte",
        career_duration_years <= quantiles_career[2] ~ "Moyenne",
        TRUE ~ "Longue"
      ),
      longevity_category = factor(longevity_category, levels = c("Courte", "Moyenne", "Longue"))
    )
  
  # Calculer la moyenne et l'erreur standard de ko_suffered_per_fight pour chaque catégorie
  summary_ko_longevity <- plot_data_longevity_cat %>%
    filter(!is.na(longevity_category)) %>%
    group_by(longevity_category) %>%
    summarise(
      mean_ko_suffered = mean(ko_suffered_per_fight, na.rm = TRUE),
      sd_ko_suffered = sd(ko_suffered_per_fight, na.rm = TRUE),
      n_ko_suffered = n(),
      se_ko_suffered = sd_ko_suffered / sqrt(n_ko_suffered),
      .groups = 'drop'
    ) %>%
    mutate(longevity_category_n = paste0(longevity_category, "\n(n=", n_ko_suffered, ")"))
  
  # Ré-ordonner les niveaux du facteur pour l'affichage avec (n=...)
  summary_ko_longevity$longevity_category_n <- factor(summary_ko_longevity$longevity_category_n,
                                                      levels = paste0(levels(summary_ko_longevity$longevity_category),
                                                                      "\n(n=", summary_ko_longevity$n_ko_suffered[match(levels(summary_ko_longevity$longevity_category), summary_ko_longevity$longevity_category)], ")"))
  
  
  # Moyenne des KO subis par combat par catégorie de longévité
  if(nrow(summary_ko_longevity) > 0 && !all(is.na(summary_ko_longevity$mean_ko_suffered))) {
    p4 <- ggplot(summary_ko_longevity, aes(x = longevity_category_n, y = mean_ko_suffered, fill = longevity_category)) +
      geom_bar(stat = "identity", na.rm = TRUE, position = position_dodge()) +
      labs(
        title = "Moyenne des KO Subis par Combat selon la Longévité de Carrière",
        subtitle = paste("Comparaison du taux de KO subis (avec effectifs).\nDéfinitions - ", quantile_labels),
        x = "Catégorie de Longévité de Carrière (avec effectif)",
        y = "Moy. KO Subis par Combat",
        caption = "Source: Données UFC"
      ) +
      theme_bw() +
      theme(legend.position = "none",
            plot.title = element_text(hjust = 0.5), 
            plot.subtitle = element_text(hjust = 0.5, size = 9))
    print(p4)
  } else {
    print("Pas assez de données agrégées ou valides pour le graphique 4.")
  }
} else {
  print("Pas assez de données de durée de carrière valides pour créer les catégories de longévité pour le graphique 4.")
}
```

**Interprétation** : On voit clairement que plus la carrière d’un combattant dure longtemps, moins il subit de KO par combat. Ceux qui restent peu de temps encaissent en moyenne 0,24 KO par combat, contre 0,20 pour une carrière moyenne, et seulement 0,15 pour les plus endurants. Autrement dit, réussir à éviter les KO semble être une vraie clé pour durer dans l’octogone.
Cette progression décroissante confirme que la capacité à éviter les KO est déterminante pour la longévité. Néanmoins, ce n'est pas forcément lié aux dommages physiques, mais simplement que si le combattant est KO, il perd le combat et a donc moins de chances de continué sa carrière à l'UFC.

#### Visualisation 6 : Variations selon la catégorie de poids

Même si la matrice de corrélation indiquait aucune corrélation entre les catégories de poids et la durée de carrière, il est intéréssant de voir la dispertion de la longétivité selon les catégories.

```{r weight_factors}
# Durée de carrière par Catégorie de Poids Principale
# calculer le nombre d'observations par groupe pour l'affichage
n_by_weight_class <- plot_data_base %>%
  filter(!is.na(main_weight_class)) %>%
  group_by(main_weight_class) %>%
  summarise(n = n(), .groups = 'drop')

plot_data_boxplot <- plot_data_base %>%
  filter(!is.na(main_weight_class)) %>%
  left_join(n_by_weight_class, by = "main_weight_class") %>%
  mutate(main_weight_class_n = paste0(main_weight_class, "\n(n=", n, ")"))

# réordonner les niveaux du facteur pour l'affichage avec (n=...)
plot_data_boxplot$main_weight_class_n <- factor(plot_data_boxplot$main_weight_class_n,
                                                levels = paste0(levels(plot_data_base$main_weight_class),
                                                                "\n(n=", n_by_weight_class$n[match(levels(plot_data_base$main_weight_class), n_by_weight_class$main_weight_class)], ")"))


if(nrow(plot_data_boxplot) > 0 && length(unique(plot_data_boxplot$main_weight_class_n[!is.na(plot_data_boxplot$main_weight_class_n)])) > 0) {
  p3 <- ggplot(plot_data_boxplot, aes(x = main_weight_class_n, y = career_duration_years, fill = main_weight_class)) +
    geom_boxplot(na.rm = TRUE, outlier.shape = 1, outlier.alpha = 0.5) + 
    labs(
      title = "Distribution de la Durée de Carrière par Catégorie de Poids",
      subtitle = "Comparaison de la longévité entre les différentes catégories de poids (avec effectifs)",
      x = "Catégorie de Poids Principale (avec effectif)",
      y = "Durée de Carrière (Années)",
      caption = "Source: Données UFC"
    ) +
    theme_bw() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1, size=8), 
          legend.position = "none",
          plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))
  print(p3)
} else {
  print("Pas assez de données ou de catégories de poids valides.")
}
```

**Interprétation** : Quand on regarde la longévité selon les catégories de poids, on remarque quelques différences intéressantes. Les combattants des catégories moyennes et mi-lourdes semblent avoir des carrières un peu plus longues en moyenne, ce qui laisse penser que ces divisions sont peut-être plus propices à durer dans le temps. À l’inverse, les poids mouches masculins ont souvent des carrières plus courtes, sans doute à cause de contraintes physiques ou du rythme imposé dans cette catégorie. Chez les femmes, la durée de carrière varie beaucoup d’une combattante à l’autre, ce qui se voit dans la dispersion des données. Mais globalement, la moyenne reste assez similaire d’une catégorie à l’autre, ce qui confirme ce qu’on voyait déjà dans la matrice de corrélation : le poids n’est pas vraiment un facteur clé pour expliquer la longévité dans l’UFC.

#### Conclusion question 6

Cette analyse révèle que les facteurs influençant la longévité des carrières UFC sont probablement plus complexes que ne le suggèrent les corrélations simples :

1. **Biais de sélection** : l'UFC elle-même influence qui reste et qui part, indépendamment des performances pures
2. **Causalité inversée** : dans certains cas, c'est peut-être la longévité qui influence les statistiques, et non l'inverse
3. **Facteurs non mesurés** : motivation personnelle, opportunités extérieures, politique interne de l'UFC, évolution des standards du sport

Les résultats suggèrent qu'une approche équilibrée (taux de victoire modéré, exposition contrôlée aux dommages, rythme de combat mesuré) pourrait favoriser la longévité. Cependant, il reste difficile de déterminer si ces patterns reflètent des choix stratégiques optimaux ou simplement les contraintes structurelles du système UFC.

Une analyse plus poussée nécessiterait des données sur les motivations des combattants, les décisions de l'organisation, et l'évolution du contexte économique du MMA. Il serait aussi interressant de réaliser une régression pour voir si tous les facteurs que nous avons étudiés ont un réel impact sur la durée de carrière.


### Question 7 : Quel combattant a montré la progression la plus spectaculaire dans ses performances ?

Nous supposons que le combattant le plus spectaculaire est sûrement celui qui a le plus de victoires.

Tout d'abord, nous allons commencer par mettre en place les statistiques de combats (victoires/défaites/no contests). 

```{r data_combat}
# 1. Statistiques de base : victoires, défaites, no contests

# Nettoyage commun
df_clean <- df %>%
  filter(outcome %in% c("fighter1", "fighter2", "Draw", "No contest")) %>%
  mutate(
    winner = case_when(
      outcome == "fighter1" ~ fighter1,
      outcome == "fighter2" ~ fighter2,
      TRUE ~ NA_character_
    ),
    loser = case_when(
      outcome == "fighter1" ~ fighter2,
      outcome == "fighter2" ~ fighter1,
      TRUE ~ NA_character_
    )
  )


# Choix de couleurs
colors_results <- c(
  "wins" = "#1b9e77",         # vert 
  "losses" = "#d95f02",       # orange
  "no_contests" = "#7570b3"   # violet
)

# Fonction pour compter les résultats
count_result <- function(data, col_name, result_name) {
  data %>%
    filter(!is.na(.data[[col_name]])) %>%
    count(.data[[col_name]], name = result_name) %>%
    rename(fighter = 1)
}

wins <- count_result(df_clean, "winner", "wins")
losses <- count_result(df_clean, "loser", "losses")

no_contests <- df_clean %>%
  filter(outcome == "No contest") %>%
  pivot_longer(cols = c(fighter1, fighter2), names_to = "role", values_to = "fighter") %>%
  count(fighter, name = "no_contests")

# Fusion des statistiques
all_stats <- full_join(wins, losses, by = "fighter") %>%
  full_join(no_contests, by = "fighter") %>%
  replace_na(list(wins = 0, losses = 0, no_contests = 0)) %>%
  mutate(
    total_fights = wins + losses + no_contests,
    ratio = if_else((losses + no_contests) > 0, wins / (losses + no_contests), NA_real_)
  )
```

#### Visualisation 1 : les 10 combattants avec le plus de victoires

Ce premier graphique permet de montrer l'aspect qui semble le plus logique : le facteur victoires.

```{r barchart_combattant_victoires}
# 2. Graphique : Top 10 des combattants avec le plus de victoires

top_winners <- all_stats %>% slice_max(wins, n = 10)

ggplot(top_winners, aes(x = reorder(fighter, wins), y = wins, fill = fighter)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Classement des 10 combattants avec le plus de victoires", x = "Combattant", y = "Victoires",
      caption = "Source: Données UFC") +
  theme_minimal() +
  scale_fill_manual(values = rep("#1b9e77", 10)) +
  guides(fill = "none")
```

**Interprétation :** 
Ce graphique met en évidence les dix combattants ayant remporté le plus grand nombre de victoires à l’UFC. Jim Miller arrive en tête avec 25 victoires, suivi de près par Donald Cerrone et Andrei Arlovski. On observe également la présence de figures notables comme Demian Maia, Charles Oliveira et Jon Jones. Ce classement reflète non seulement la performance et la régularité de ces combattants, mais aussi leur capacité à maintenir un haut niveau de compétitivité sur le long terme. Il s’agit ici d’un indicateur clé de succès individuel dans l’octogone.
On voit donc que Jim Miller est le combattant le plus victorieux mais est-ce qu'il est vraiment le combattant ayant la progression la plus spectaculaire. Le graphique répond partiellement à la question car il faudrait vérifier si le combattant avec le plus de victoires n'a pas plus de défaites par rapport aux autres. En effet, on pourrait avoir un combattant avec le plus de victoires mais qui n'a pas forcément le meilleur ratio victoires/défaites.


#### Visualisation 2 : classement des 10 meilleurs combattants avec le plus grand nombre de combats (au moins 30 combats)

Cette deuxième visualisation permet de vérifier ou non l'hypothèse précédente en visualisant les 10 combattants avec le meilleur ratio victoires/défaites/no contests. On va prendre un échantillon avec les combattants ayant le plus de combats (au moins 30 combats).

```{r barchart_combattant}
# 3. Graphique : Top 10 par nombre total de combats

top_total <- all_stats %>%
  filter(total_fights >= 5) %>%
  slice_max(total_fights, n = 10) %>%
  pivot_longer(cols = c(wins, losses, no_contests), names_to = "result", values_to = "count") %>%
  mutate(result = factor(result, levels = c("no_contests", "losses", "wins")))

ggplot(top_total, aes(x = fct_reorder(fighter, total_fights), y = count, fill = result)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Classement des 10 meilleurs combattants (avec au moins 30 combats)", x = "Combattant", y = "Nombre de combats",
      caption = "Source: Données UFC", fill = "Résultat") +
  theme_minimal() +
  scale_fill_manual(
    values = colors_results[c("no_contests", "losses", "wins")],
    labels = c("No Contest", "Défaites", "Victoires"),
  )
```

**Interprétation :** 
Ce graphique montre les combattants les plus expérimentés de l’UFC en termes de nombre total de combats, en distinguant les victoires, les défaites et les "No Contest". Jim Miller domine à nouveau, soulignant à la fois sa longévité et sa constance. Andrei Arlovski et Donald Cerrone figurent également en haut du classement. Ce graphique révèle non seulement l’endurance physique et mentale de ces athlètes sur le long terme, mais aussi leur rôle en tant que piliers de l'organisation. Certains combattants affichent un équilibre entre victoires et défaites, tandis que d’autres se distinguent par leur réussite ou leur persévérance malgré les revers.
On voit que le combattant avec le meilleur ratio correspond bien à celui qui a eu le plus de victoires dans sa carrière. Jim Miller serait donc le combattant avec la carrière la plus spectaculaire.
C'est celui qui a le plus de victoires et le plus de combats à son actif. C'est donc le plus légitime à avoir le statut du combattant le plus spectaculaire.
Cependant, il faudrait vérifier s'il n'y a pas des combattants avec moins de combats mais un ratio victoires/défaites/no contest beaucoup plus important que Jim Miller.

#### Visualisation 3 : classement des 10 meilleurs combattants avec au moins 10 combats

Cette visualisation va permettre de vérifier si le classement précédent est correct ou non. Il y a sûrement des combattants ayant fait moins de 30 combats avec de meilleurs résultats à l'UFC. 

```{r barchart_combattant2}
# 4. Graphique des 10 combattants avec le plus de victoires et le moins de défaites/no contests

top_ratios <- all_stats %>%
  filter(!is.na(ratio), total_fights >= 10) %>%
  slice_max(ratio, n = 10) %>%
  pivot_longer(cols = c(wins, losses, no_contests), names_to = "result", values_to = "count") %>%
  mutate(result = factor(result, levels = c("no_contests", "losses", "wins")))

ggplot(top_ratios, aes(x = reorder(fighter, ratio), y = count, fill = result)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Classement des 10 meilleurs combattants (avec au moins 10 combats)", x = "Combattant", y = "Nombre de combats",
      caption = "Source: Données UFC", fill = "Résultat") +
  theme_minimal() +
  scale_fill_manual(
    values = colors_results[c("no_contests", "losses", "wins")],
    labels = c("No Contest", "Défaites", "Victoires"),
  )
```

**Interprétation :** 
Le graphique révèle que Jon Jones domine ce classement avec environ 23 combats au total dont 21 victoires, suivi de près par Georges St-Pierre avec 22 combats. On distingue ensuite un groupe intermédiaire composé de Demetrious Johnson, Kamaru Usman et Amanda Nunes, qui comptabilisent chacun entre 16 et 18 combats.

Islam Makhachev et Alexander Volkanovski affichent un profil similaire avec environ 13-14 combats chacun, tandis que Arnold Allen, Magomed Ankalaev et Don Frye ferment ce top 10 avec approximativement 10-11 combats.

Le graphique montre de façon remarquable que tous ces combattants d'élite partagent une caractéristique commune : une écrasante majorité de victoires par rapport aux défaites, avec Jon Jones qui se distingue avec le meilleur palmarès à l'UFC.

Ce graphiquea aussi été réalisé sur la Shiny app. Il permet de filtrer les combattants selon le nombre de combats, offrant ainsi la possibilité d’analyser les différents ratios pour des seuils allant de 10 à 40 combats.
Il reprend ainsi les idées des graphiques précédents.

Au regard de ce graphique et de son palmarès exceptionnel, Jon Jones s'impose indéniablement comme le combattant le plus spectaculaire de l'UFC, ayant non seulement accumulé le plus grand nombre de combats au plus haut niveau, mais ayant également maintenu une domination quasiment absolue tout au long de sa carrière légendaire.

#### Visualisation 4 : évolution des performances de Jim Miller

Ce graphique permet de voir l'évolution des performances d'un des meilleur combattant UFC durant le temps et vérifier la légitimité du caractère spectaculaire. Nous allons donc voir qui de Jim Miller et Jon Jones a les meilleurs performances.

```{r linechart_jim_miller}
# 5. Évolution des performances de Jim Miller

# Fonction d’évolution des performances d’un combattant
plot_fighter_performance <- function(df, fighter_name, outcome_var = "outcome_indicator") {
  fighter_data <- df %>%
    filter(fighter1 == fighter_name | fighter2 == fighter_name) %>%
    mutate(
      event_date = as.Date(event_date),
      is_fighter1 = fighter1 == fighter_name,
      sig_strikes_accuracy = if_else(is_fighter1, fighter1_sig_strikes_accuracy, fighter2_sig_strikes_accuracy),
      takedown_avg_per15m = if_else(is_fighter1, fighter1_takedown_avg_per15m, fighter2_takedown_avg_per15m),
      sig_strikes_defended = if_else(is_fighter1, fighter1_sig_strikes_defended, fighter2_sig_strikes_defended),
      !!outcome_var := case_when(
        (outcome == "fighter1" & is_fighter1) | (outcome == "fighter2" & !is_fighter1) ~ 1,
        outcome %in% c("fighter1", "fighter2") ~ 0,
        TRUE ~ NA_real_
      )
    ) %>%
    arrange(event_date) %>%
    select(event_date, all_of(outcome_var), sig_strikes_accuracy, takedown_avg_per15m, sig_strikes_defended) %>%
    pivot_longer(cols = -event_date, names_to = "metric", values_to = "value") %>%
    filter(!is.na(value))

  ggplot(fighter_data, aes(x = event_date, y = value, color = metric)) +
    geom_step(size = 1) +
    geom_point(size = 2) +
    labs(
      title = paste("Évolution des performances de", fighter_name),
      subtitle = "Indicateurs clés par combat",
      x = "Date du combat",
      y = "Valeur",
      caption = "Source: Données UFC",
      color = "Indicateur"
    ) +
    theme_minimal() +
    theme(legend.position = "bottom") +
    scale_color_manual(
      values = setNames(
        c("#1b9e77", "blue", "purple", "orange"),
        c(outcome_var, "sig_strikes_accuracy", "takedown_avg_per15m", "sig_strikes_defended")
      ),
      labels = setNames(
        c("Victoire (1 = oui, 0 = non)", "Précision frappes (%)", "Takedowns / 15min", "Défense frappes (%)"),
        c(outcome_var, "sig_strikes_accuracy", "takedown_avg_per15m", "sig_strikes_defended")
      )
    )
}


#Graphique des performances de Jim Miller
plot_fighter_performance(df, "Jim Miller", "jim_outcome")
```

**Interprétation :** 
Le graphique présente l’évolution des performances de Jim Miller au fil de sa carrière à l’UFC, à travers plusieurs indicateurs clés. On observe une alternance régulière de victoires et de défaites, témoignant d’une carrière marquée par une certaine irrégularité sur le plan des résultats.
Cependant, ses statistiques techniques (précision des frappes, défense des frappes et takedowns moyens) restent globalement stables dans le temps, ce qui s’explique probablement par le fait que le dataset utilise des moyennes sur l’ensemble de sa carrière plutôt que des données combat par combat. Cela rend difficile l’analyse de sa progression réelle au fil du temps, mais on peut tout de même constater une régularité dans ses performances, ce qui reflète sa longévité et sa constance dans l’UFC. Sa précision de frappe tourne autour de 40 %, sa défense avoisine les 60 %, et il maintient une moyenne élevée de 1,6 takedown réussi toutes les 15 minutes. Cela traduit un style de combat bien établi, orienté vers le grappling, ainsi qu’une constance technique malgré les aléas des combats.

#### Visualisation 5 : évolution des performances de Jon Jones

```{r linechart_jon_jones}
# 6. Évolution des performances de Jon Jones

#Graphique des performances de Jon Jones
plot_fighter_performance(df, "Jon Jones", "jones_outcome")
```

**Interprétation :** 
Le graphique démontre de manière frappante la domination de Jon Jones avec une ligne verte des victoires maintenue constamment à 1.0 (victoire) sur pratiquement toute sa carrière de 2010 à 2020. Cette constance est remarquable dans un sport aussi imprévisible que le MMA. La seule interruption visible vers 2011 correspond à une chute brutale vers 0, représentant sa seule défaite officielle dans cette période.

Cette quasi-perfection statistique illustre une maîtrise technique et mentale exceptionnelle qui lui a permis de maintenir un niveau d'excellence sur une décennie complète de compétition au plus haut niveau (UFC).

Cependant, comme Jim Miller, on remarque que ses statistiques restent constantes dans le temps, ce qui s’explique probablement par le fait que le dataset utilise des moyennes sur l’ensemble de sa carrière plutôt que des données combat par combat. 

De plus, il possède une précision de frappes hors normes autour de 55-60% et une défense autour de 60-65%. On remarque aussi que Jones n'a jamais abandonné sa base de lutte et maintient une approche complète du combat car il réalise 2 takedowns tous les 15 minutes. 

C'est donc un combattant qui domine tous les aspects du MMA (frappes,défense et lutte) et qui peut être considéré comme le plus spectaculaire.

##### Conclusion question 7

D’après notre analyse graphique, deux figures majeures se démarquent par la singularité et la richesse de leur parcours : Jon Jones et Jim Miller. Bien que radicalement différents, chacun incarne à sa manière une forme de grandeur dans l’histoire de l’UFC.

D’un côté, Jon Jones impressionne par une carrière presque sans faille. Invaincu à l’exception d’une unique défaite controversée et d’un no contest, il affiche une domination technique rare. Sa précision de frappe (57 %), sa défense efficace (64 %) et sa moyenne de 2 takedowns par combat témoignent de sa maîtrise globale du MMA. Il représente le combattant le plus complet et spectaculaire de sa génération.

De l’autre, Jim Miller incarne la longévité et la résilience. Détenteur du record du plus grand nombre de combats et de victoires à l’UFC, il compense des statistiques plus modestes (40 % de précision, 58 % de défense) par une constance admirable et une capacité à rebondir après chaque revers. Sa carrière est un hommage à la persévérance et à l’endurance mentale.

Le contraste entre ces deux légendes dépasse les chiffres. Jones incarne la quête de perfection et la domination implacable, tandis que Miller illustre la force tranquille de ceux qui refusent d’abandonner.

En conclusion, si l’on devait désigner le combattant à la progression la plus spectaculaire, le choix s’impose : Jon Jones, par la constance de ses performances et l’étendue de sa supériorité, s’affirme comme le plus impressionnant.

### Question 8 : En quoi le style de combat, qu'il soit offensif ou défensif, influence-t-il le déroulement et l'issue d’un combat ?

Nous allons découvrir l'influence qu'a la stratégie de combat sur l'issue de l'affrontement

```{r formating data}
df <- data

filtered_df <- df %>%
  filter(weight_class %in% c("Featherweight", "Middleweight", "Heavyweight"))

sig_strikes <- filtered_df %>%
  select(weight_class, fighter1_sig_strikes_landed_pm, fighter2_sig_strikes_landed_pm) %>%
  rename(f1 = fighter1_sig_strikes_landed_pm, f2 = fighter2_sig_strikes_landed_pm) %>%
  pivot_longer(cols = c(f1, f2), names_to = "fighter", values_to = "strikes") %>%
  filter(!is.na(strikes))

avg_strikes <- sig_strikes %>%
  group_by(weight_class) %>%
  summarise(avg_strikes = mean(strikes, na.rm = TRUE))


```


#### Visualisation 1 : Différence d'activité entre les catégories de poids

```{r graph_1_q8}
ggplot(avg_strikes, aes(x = weight_class, y = avg_strikes, fill = weight_class)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(avg_strikes, 1)), vjust = -0.5, size = 4) +
  labs(
    title = "Nombre moyen de coups significatifs/min par catégorie de poids",
    x = "Catégorie de poids",
    y = "Coups/min",
    caption = "Source: Données UFC"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

**Interprétation :** 
On observe des différences notables selon la catégorie de poids. Les combattants Featherweight tendent à envoyer plus de frappes significatives par minute, ce qui peut être attribué à leur mobilité et à leur style plus orienté vers les échanges rapides. À l'inverse, les Heavyweights frappent moins souvent mais avec potentiellement plus de puissance. Il faut donc garder à l'esprit le fait que les stratégies de combats peuvent être significativement différentes selon la catégorie de poids.





#### Visualisation 2 : Analyse des différences stratégiques entre les gagnants et les perdants

```{r graph_2_q8}
# Créer une variable "vainqueur"
df_resultat <- df %>%
  filter(outcome %in% c("fighter1", "Draw", "No contest")) %>%
  mutate(winner = case_when(
    outcome == "fighter1" ~ "fighter1",
    outcome %in% c("Draw", "No contest") ~ "None",
    TRUE ~ "fighter2"
  ))

# Séparer les frappes par combattant et associer le résultat
f1 <- df_resultat %>%
  transmute(strikes = fighter1_sig_strikes_landed_pm,
            result = ifelse(winner == "fighter1", "Victoire", "Défaite"))

f2 <- df_resultat %>%
  transmute(strikes = fighter2_sig_strikes_landed_pm,
            result = ifelse(winner == "fighter2", "Victoire", "Défaite"))

strikes_df <- bind_rows(f1, f2) %>%
  filter(!is.na(strikes))

# Visualisation
ggplot(strikes_df, aes(x = result, y = strikes, fill = result)) +
  geom_boxplot(alpha = 0.7) +
  labs(
    title = "Frappes significatives par minute : Victoire vs Défaite",
    x = "Résultat du combat",
    y = "Frappes significatives / min",
    caption = "Source: Données UFC"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

**Interprétation :** 
Les vainqueurs envoient généralement plus de frappes significatives par minute que les perdants. Cela suggère qu’un style offensif, basé sur l'activité en striking, est souvent associé à une plus grande probabilité de victoire.


```{r graph_3_q8}
# Préparer les données pour takedowns
f1_td <- df_resultat %>%
  transmute(takedowns = fighter1_takedown_avg_per15m,
            result = ifelse(winner == "fighter1", "Victoire", "Défaite"))

f2_td <- df_resultat %>%
  transmute(takedowns = fighter2_takedown_avg_per15m,
            result = ifelse(winner == "fighter2", "Victoire", "Défaite"))

takedown_df <- bind_rows(f1_td, f2_td) %>%
  filter(!is.na(takedowns))

# Visualisation
ggplot(takedown_df, aes(x = result, y = takedowns, fill = result)) +
  geom_boxplot(alpha = 0.7) +
  labs(
    title = "Tentatives de takedown par 15 minutes : Victoire vs Défaite",
    x = "Résultat du combat",
    y = "Tentatives de takedown / 15 min",
    caption = "Source: Données UFC"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

**Interprétation :** 
Les gagnants ont, en moyenne, un volume légèrement supérieur de tentatives de takedown. Bien que moins flagrant que pour les frappes, cela montre que les compétences en lutte peuvent jouer un rôle déterminant, notamment en contrôle du combat au sol.

```{r graph_4_q8}
# Préparation des données : frappes absorbées
f1_abs <- df_resultat %>%
  transmute(absorbed = fighter1_sig_strikes_absorbed_pm,
            result = ifelse(winner == "fighter1", "Victoire", "Défaite"))

f2_abs <- df_resultat %>%
  transmute(absorbed = fighter2_sig_strikes_absorbed_pm,
            result = ifelse(winner == "fighter2", "Victoire", "Défaite"))

absorbed_df <- bind_rows(f1_abs, f2_abs) %>%
  filter(!is.na(absorbed))

# Visualisation
ggplot(absorbed_df, aes(x = result, y = absorbed, fill = result)) +
  geom_boxplot(alpha = 0.7) +
  labs(
    title = "Frappes significatives absorbées par minute : Victoire vs Défaite",
    x = "Résultat du combat",
    y = "Frappes absorbées / min",
    caption = "Source: Données UFC"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

**Interprétation :** 
Les perdants encaissent significativement plus de frappes. Cela confirme qu’encaisser trop de coups sans réponse efficace augmente fortement le risque de défaite.


```{r graph_5_q8}
# Préparation des données : frappes défendues
f1_def <- df_resultat %>%
  transmute(defended = fighter1_sig_strikes_defended,
            result = ifelse(winner == "fighter1", "Victoire", "Défaite"))

f2_def <- df_resultat %>%
  transmute(defended = fighter2_sig_strikes_defended,
            result = ifelse(winner == "fighter2", "Victoire", "Défaite"))

defended_df <- bind_rows(f1_def, f2_def) %>%
  filter(!is.na(defended))

# Visualisation
ggplot(defended_df, aes(x = result, y = defended, fill = result)) +
  geom_boxplot(alpha = 0.7) +
  labs(
    title = "Frappes significatives défendues : Victoire vs Défaite",
    x = "Résultat du combat",
    y = "Taux de défense des frappes significatives",
    caption = "Source: Données UFC"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

**Interprétation :** 
Les vainqueurs présentent un taux de défense plus élevé. Une meilleure capacité à éviter les frappes semble être un facteur clé pour gagner, notamment en stand-up.

```{r graph_6_q8}
# Préparation des données : takedown defense
f1_td_def <- df_resultat %>%
  transmute(defence = fighter1_takedown_defence,
            result = ifelse(winner == "fighter1", "Victoire", "Défaite"))

f2_td_def <- df_resultat %>%
  transmute(defence = fighter2_takedown_defence,
            result = ifelse(winner == "fighter2", "Victoire", "Défaite"))

td_def_df <- bind_rows(f1_td_def, f2_td_def) %>%
  filter(!is.na(defence))

# Visualisation
ggplot(td_def_df, aes(x = result, y = defence, fill = result)) +
  geom_boxplot(alpha = 0.7) +
  labs(
    title = "Taux de défense contre les takedowns : Victoire vs Défaite",
    x = "Résultat du combat",
    y = "Taux de défense (0 à 1)",
    caption = "Source: Données UFC"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

**Interprétation :** 
Une défense de takedown plus solide est associée à la victoire. Cela montre l'importance de résister aux tentatives de mise au sol, en particulier contre des combattants spécialisés en grappling.

#### Visualisation 3 : Mise en avant des tendances favorisant la victoire

```{r graph_7_q8}
# Combiner les frappes envoyées avec le résultat
f1 <- df_resultat %>%
  transmute(strikes = fighter1_sig_strikes_landed_pm,
            result = ifelse(winner == "fighter1", 1, 0))

f2 <- df_resultat %>%
  transmute(strikes = fighter2_sig_strikes_landed_pm,
            result = ifelse(winner == "fighter2", 1, 0))

strikes_volume_df <- bind_rows(f1, f2) %>%
  filter(!is.na(strikes)) %>%
  mutate(bin = cut(strikes, breaks = seq(0, 10, by = 1), include.lowest = TRUE))

# Calcul du taux de victoire pour chaque tranche de volume
strikes_summary <- strikes_volume_df %>%
  group_by(bin) %>%
  summarise(taux_victoire = mean(result), .groups = "drop")

# Visualisation
ggplot(strikes_summary, aes(x = bin, y = taux_victoire)) +
  geom_col(fill = "#2C77B8") +
  geom_text(aes(label = scales::percent(taux_victoire, accuracy = 1)), 
            vjust = -0.3, size = 3.5) +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(
    title = "Taux de victoire en fonction du volume de frappes significatives envoyées",
    x = "Frappes significatives / min (tranches)",
    y = "Taux de victoire",
    caption = "Source: Données UFC"
  ) +
  theme_minimal()
```

**Interprétation :** 
Le taux de victoire augmente clairement avec le volume de frappes envoyées. Cela confirme qu’une pression constante et une activité offensive élevée favorisent la victoire.

```{r graph_8_q8}
# Combiner les frappes encaissées avec le résultat
f1_abs <- df_resultat %>%
  transmute(absorbed = fighter1_sig_strikes_absorbed_pm,
            result = ifelse(winner == "fighter1", 1, 0))

f2_abs <- df_resultat %>%
  transmute(absorbed = fighter2_sig_strikes_absorbed_pm,
            result = ifelse(winner == "fighter2", 1, 0))

absorbed_volume_df <- bind_rows(f1_abs, f2_abs) %>%
  filter(!is.na(absorbed)) %>%
  mutate(bin = cut(absorbed, breaks = seq(0, 10, by = 1), include.lowest = TRUE))

# Calcul du taux de victoire pour chaque tranche de frappes encaissées
absorbed_summary <- absorbed_volume_df %>%
  group_by(bin) %>%
  summarise(taux_victoire = mean(result), .groups = "drop")

# Visualisation
ggplot(absorbed_summary, aes(x = bin, y = taux_victoire)) +
  geom_col(fill = "#D95F02") +
  geom_text(aes(label = scales::percent(taux_victoire, accuracy = 1)), 
            vjust = -0.3, size = 3.5) +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(
    title = "Taux de victoire selon le volume de frappes significatives encaissées",
    x = "Frappes encaissées / min (tranches)",
    y = "Taux de victoire",
    caption = "Source: Données UFC"
  ) +
  theme_minimal()
```

**Interprétation :** 
Le taux de victoire diminue avec l'augmentation des frappes encaissées. Cela renforce l'idée qu’une bonne défense et un faible nombre de coups reçus sont essentiels pour gagner.

```{r graph_9_q8}
# Combiner les frappes défendues avec le résultat
f1_def <- df_resultat %>%
  transmute(defended = fighter1_sig_strikes_defended,
            result = ifelse(winner == "fighter1", 1, 0))

f2_def <- df_resultat %>%
  transmute(defended = fighter2_sig_strikes_defended,
            result = ifelse(winner == "fighter2", 1, 0))

defended_volume_df <- bind_rows(f1_def, f2_def) %>%
  filter(!is.na(defended)) %>%
  mutate(bin = cut(defended, breaks = seq(0, 1, by = 0.1), include.lowest = TRUE))

# Calcul du taux de victoire par tranche
defended_summary <- defended_volume_df %>%
  group_by(bin) %>%
  summarise(taux_victoire = mean(result), .groups = "drop")

# Visualisation
ggplot(defended_summary, aes(x = bin, y = taux_victoire)) +
  geom_col(fill = "#1B9E77") +
  geom_text(aes(label = scales::percent(taux_victoire, accuracy = 1)), 
            vjust = -0.3, size = 3.5) +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(
    title = "Taux de victoire selon le taux de frappes significatives défendues",
    x = "Taux de défense (tranches)",
    y = "Taux de victoire",
    caption = "Source: Données UFC"
  ) +
  theme_minimal()
```

**Interprétation :**
Les combattants qui défendent mieux les frappes ont un taux de victoire plus élevé. Cela suggère que l'efficacité défensive, bien que moins visible que l'offensive, est un levier important de performance.

```{r graph_10_q8}
# Préparer les données pour gagnants et perdants
f1 <- df_resultat %>%
  transmute(
    accuracy = fighter1_sig_strikes_accuracy,
    result = ifelse(outcome == "fighter1", 1, 0)
  )

f2 <- df_resultat %>%
  transmute(
    accuracy = fighter2_sig_strikes_accuracy,
    result = ifelse(outcome == "fighter2", 1, 0)
  )

accuracy_df <- bind_rows(f1, f2) %>%
  filter(!is.na(accuracy)) %>%
  mutate(
    bin = cut(accuracy, breaks = seq(0, 1, by = 0.1), include.lowest = TRUE)
  )

# Calcul du taux de victoire et du nombre de cas
accuracy_summary <- accuracy_df %>%
  group_by(bin) %>%
  summarise(
    taux_victoire = mean(result),
    n = n(),
    .groups = "drop"
  )

# Bar plot avec pourcentage et nombre de cas
ggplot(accuracy_summary, aes(x = bin, y = taux_victoire)) +
  geom_col(fill = "#2C77B8") +
  geom_text(aes(label = paste0(scales::percent(taux_victoire, accuracy = 1), "\n(n=", n, ")")), 
            vjust = -0.5, size = 3.5) +
  scale_y_continuous(labels = scales::percent_format(), limits = c(0, 1.1)) +
  labs(
    title = "Taux de victoire en fonction de la précision des frappes",
    x = "Précision (tranches)",
    y = "Taux de victoire",
    caption = "Source: Données UFC"
  ) +
  theme_minimal()
```

**Interprétation :** 
Les combattants plus précis dans leurs frappes ont un taux de victoire supérieur. La précision est donc une variable de succès, surtout si elle est combinée à un volume élevé.


#### Visualisation 4 : Y'a t-il un secteur à privilégier pour espérer gagner

```{r graph_11_q8}

# Extraire gagnants et perdants dans les 3 catégories
combined_df <- df_resultat %>%
  filter(
    outcome %in% c("fighter1", "fighter2"),
    weight_class %in% c("Welterweight", "Featherweight", "Heavyweight")
  ) %>%
  mutate(
    fighter = ifelse(outcome == "fighter1", fighter1, fighter2),
    strikes_landed = ifelse(outcome == "fighter1", fighter1_sig_strikes_landed_pm, fighter2_sig_strikes_landed_pm),
    strikes_defended = ifelse(outcome == "fighter1", fighter1_sig_strikes_defended, fighter2_sig_strikes_defended),
    result = "Victoire"
  ) %>%
  bind_rows(
    df_resultat %>%
      filter(
        outcome %in% c("fighter1", "fighter2"),
        weight_class %in% c("Welterweight", "Featherweight", "Heavyweight")
      ) %>%
      mutate(
        fighter = ifelse(outcome == "fighter1", fighter2, fighter1),
        strikes_landed = ifelse(outcome == "fighter1", fighter2_sig_strikes_landed_pm, fighter1_sig_strikes_landed_pm),
        strikes_defended = ifelse(outcome == "fighter1", fighter2_sig_strikes_defended, fighter1_sig_strikes_defended),
        result = "Défaite"
      )
  ) %>%
  filter(!is.na(strikes_landed), !is.na(strikes_defended))

# Bubble chart final (taille fixe, couleur par résultat)
ggplot(combined_df, aes(
  x = strikes_landed,
  y = strikes_defended,
  color = result
)) +
  geom_point(alpha = 0.6, size = 3) +
  scale_color_manual(values = c("Victoire" = "green3", "Défaite" = "red3")) +
  labs(
    title = "Positionnement offensif/défensif des combattants",
    subtitle = "Gagnants (verts) vs Perdants (rouges)",
    x = "Frappes significatives envoyées / min",
    y = "Taux de frappes significatives défendues",
    caption = "Source: Données UFC",
    color = "Résultat"
  ) +
  theme_minimal()




# Combattants gagnants
winners_acc_abs <- df_resultat %>%
  filter(
    outcome %in% c("fighter1", "fighter2"),
    weight_class %in% c("Welterweight", "Featherweight", "Heavyweight")
  ) %>%
  mutate(
    fighter = ifelse(outcome == "fighter1", fighter1, fighter2),
    accuracy = ifelse(outcome == "fighter1", fighter1_sig_strikes_accuracy, fighter2_sig_strikes_accuracy),
    absorbed = ifelse(outcome == "fighter1", fighter1_sig_strikes_absorbed_pm, fighter2_sig_strikes_absorbed_pm),
    result = "Victoire"
  )

# Combattants perdants
losers_acc_abs <- df_resultat %>%
  filter(
    outcome %in% c("fighter1", "fighter2"),
    weight_class %in% c("Welterweight", "Featherweight", "Heavyweight")
  ) %>%
  mutate(
    fighter = ifelse(outcome == "fighter1", fighter2, fighter1),
    accuracy = ifelse(outcome == "fighter1", fighter2_sig_strikes_accuracy, fighter1_sig_strikes_accuracy),
    absorbed = ifelse(outcome == "fighter1", fighter2_sig_strikes_absorbed_pm, fighter1_sig_strikes_absorbed_pm),
    result = "Défaite"
  )

# Combiner et nettoyer
combined_acc_abs <- bind_rows(winners_acc_abs, losers_acc_abs) %>%
  filter(!is.na(accuracy), !is.na(absorbed))

# Graphique
ggplot(combined_acc_abs, aes(x = accuracy, y = absorbed, color = result)) +
  geom_point(alpha = 0.6, size = 3) +
  scale_color_manual(values = c("Victoire" = "green3", "Défaite" = "red3")) +
  labs(
    title = "Précision des frappes vs Coups encaissés",
    subtitle = "Gagnants (verts) vs Perdants (rouges)",
    x = "Précision des frappes significatives",
    y = "Frappes significatives encaissées / min",
    caption = "Source: Données UFC",
    color = "Résultat"
  ) +
  theme_minimal()
```

**Interprétation :** 
Les deux derniers graphiques montrent que les gagnants et les perdants peuvent partager des caractéristiques similaires en matière de volume offensif, de précision ou de défense. Cela signifie qu’un style ou un indicateur isolé ne suffit pas à expliquer le succès. Ce résultat met en évidence la complexité du MMA, où l’issue d’un combat dépend probablement d’un ensemble d’éléments combinés : stratégie, timing, conditions du jour, erreurs adverses, etc.

<a id="section-4"></a>

# III. Conclusion

Ce projet nous a permis d’explorer en détail le monde du MMA à travers les données de l’UFC. En croisant les informations issues des combats et celles des combattants, on a pu dégager plusieurs **tendances** très intéressantes, comme l’évolution du nombre de combats au fil du temps, l’impact de certaines caractéristiques physiques sur les performances ou encore le rôle joué par les cotes de paris.

Cette analyse nous a donc aidés à mieux comprendre les facteurs qui peuvent **influencer les résultats** d’un combat. Même si certains liens étaient attendus, d’autres résultats ont été plus surprenants et ont suscité des discussions enrichissantes au sein du groupe.

Ce travail pose aussi les bases pour aller plus loin : on pourrait approfondir l'analyse des paris sportifs, intégrer d’autres sources de données ou encore mettre l'accent sur l'analyse des combattantes. Pour conclure, c'était un projet riche qui nous a permis de mettre en pratique nos compétences tout en explorant un sujet original et passionnant.

### Organisation du travail

**Romain GOLDENCHTEIN** : questions 4, 6, graphique sur la shiny app et dashboard

**Samy EHSANI** : questions 2 et 5

**Jasser CHATBA** : questions 1, 7 et graphique sur la shiny app 

**Mohamed AAZOUZ** : questions 3 et 8